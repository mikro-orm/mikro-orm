// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`4898 ambiguous_fk_example scalarPropertiesForRelations=always entitySchema=false: 4898 ambiguous_fk_example scalarPropertiesForRelations=always entitySchema=false 1`] = `
[
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';
import { ProductColors } from './ProductColors';
import { Products } from './Products';

@Entity()
export class Colors {

  [PrimaryKeyProp]?: 'colorId';

  @PrimaryKey()
  colorId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

  @ManyToMany({ entity: () => Products, pivotTable: 'product_colors', pivotEntity: () => ProductColors, joinColumn: 'color_id', inverseJoinColumn: 'product_id' })
  productColors = new Collection<Products>(this);

}
",
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';
import { ProductSizes } from './ProductSizes';
import { Sellers } from './Sellers';

@Entity()
export class Countries {

  [PrimaryKeyProp]?: 'country';

  @PrimaryKey({ columnType: 'char(2)' })
  country!: unknown;

  @ManyToMany({ entity: () => ProductSizes, pivotTable: 'product_countries', joinColumn: 'country', inverseJoinColumn: 'product_id' })
  productCountries = new Collection<ProductSizes>(this);

  @ManyToMany({ entity: () => Sellers, pivotTable: 'seller_countries', joinColumn: 'country', inverseJoinColumn: 'seller_id' })
  sellerCountries = new Collection<Sellers>(this);

}
",
  "import { Entity, Index, ManyToOne, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';
import { Colors } from './Colors';
import { Products } from './Products';

@Entity()
export class ProductColors {

  [PrimaryKeyProp]?: ['colorId', 'productId', 'color', 'product'];

  @PrimaryKey({ persist: false })
  colorId!: number;

  @Index({ name: 'fk_product_colors_products1_idx' })
  @PrimaryKey({ persist: false })
  productId!: number;

  @ManyToOne({ entity: () => Colors, fieldName: 'color_id', primary: true })
  color!: Colors;

  @ManyToOne({ entity: () => Products, fieldName: 'product_id', primary: true, index: 'fk_product_colors_products1_idx' })
  product!: Products;

}
",
  "import { Entity, OneToOne, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';
import { Products } from './Products';

@Entity()
@Unique({ name: 'size__product_id-UNIQUE', properties: ['size', 'productId'] })
export class ProductSizes {

  [PrimaryKeyProp]?: ['productId', 'product'];

  @PrimaryKey({ persist: false })
  productId!: number;

  @Property({ columnType: 'smallint' })
  size!: number;

  @OneToOne({ entity: () => Products, fieldName: 'product_id', primary: true })
  product!: Products;

}
",
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';
import { SellerProducts } from './SellerProducts';
import { Sellers } from './Sellers';

@Entity()
export class Products {

  [PrimaryKeyProp]?: 'productId';

  @PrimaryKey()
  productId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

  @ManyToMany({ entity: () => Sellers, pivotTable: 'seller_products', pivotEntity: () => SellerProducts, joinColumn: 'product_id', inverseJoinColumn: 'seller_id' })
  sellerProducts = new Collection<Sellers>(this);

}
",
  "import { Entity, Index, ManyToOne, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';
import { ProductColors } from './ProductColors';
import { ProductSizes } from './ProductSizes';
import { SellerProducts } from './SellerProducts';

@Entity()
@Index({ name: 'fk_sales_product_countries1_idx', expression: 'create index \`fk_sales_product_countries1_idx\` on \`sales\` (\`country\`, \`product_id\`)')
@Index({ name: 'fk_sales_seller_countries1_idx', expression: 'create index \`fk_sales_seller_countries1_idx\` on \`sales\` (\`country\`, \`seller_id\`)')
@Index({ name: 'fk_sales_seller_products1_idx', expression: 'create index \`fk_sales_seller_products1_idx\` on \`sales\` (\`seller_id\`, \`product_id\`)')
@Unique({ name: 'product_id__size__color_id-UNIQUE', properties: ['colorId', 'productSizes'] })
export class Sales {

  [PrimaryKeyProp]?: 'saleId';

  @PrimaryKey()
  saleId!: number;

  @Property({ columnType: 'char(2)', persist: false })
  country!: unknown;

  @Property({ persist: false })
  sellerId!: number;

  @Index({ name: 'product_id_idx' })
  @Property({ persist: false })
  productId!: number;

  @Property({ nullable: true, persist: false })
  colorId?: number;

  @Property({ columnType: 'smallint', nullable: true, persist: false })
  size?: number;

  @Property({ nullable: true, persist: false })
  exchangedProductId?: number;

  @ManyToOne({ entity: () => ProductColors, fieldNames: ['color_id', 'product_id'], nullable: true, index: 'fk_sales_product_colors1_idx' })
  color?: ProductColors;

  @ManyToOne({ entity: () => ProductSizes, fieldNames: ['size', 'product_id'], nullable: true, index: 'fk_sales_product_sizes1_idx' })
  productSizes?: ProductSizes;

  @ManyToOne({ entity: () => SellerProducts, fieldNames: ['seller_id', 'exchanged_product_id'], nullable: true, index: 'fk_sales_seller_products2_idx' })
  exchanged?: SellerProducts;

}
",
  "import { Entity, Index, ManyToOne, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';
import { Products } from './Products';
import { Sellers } from './Sellers';

@Entity()
export class SellerProducts {

  [PrimaryKeyProp]?: ['sellerId', 'productId', 'product', 'seller'];

  @PrimaryKey({ persist: false })
  sellerId!: number;

  @Index({ name: 'fk_seller_products_products1_idx' })
  @PrimaryKey({ persist: false })
  productId!: number;

  @ManyToOne({ entity: () => Products, fieldName: 'product_id', primary: true, index: 'fk_seller_products_products1_idx' })
  product!: Products;

  @ManyToOne({ entity: () => Sellers, fieldName: 'seller_id', primary: true })
  seller!: Sellers;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Sellers {

  [PrimaryKeyProp]?: 'sellerId';

  @PrimaryKey()
  sellerId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

}
",
]
`;

exports[`4898 ambiguous_fk_example scalarPropertiesForRelations=always entitySchema=true: 4898 ambiguous_fk_example scalarPropertiesForRelations=always entitySchema=true 1`] = `
[
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { Products } from './Products';

export class Colors {
  [PrimaryKeyProp]?: 'colorId';
  colorId!: number;
  name!: string;
  productColors = new Collection<Products>(this);
}

export const ColorsSchema = new EntitySchema({
  class: Colors,
  properties: {
    colorId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
    productColors: {
      kind: 'm:n',
      entity: () => Products,
      pivotTable: 'product_colors',
      pivotEntity: () => ProductColors,
      joinColumn: 'color_id',
      inverseJoinColumn: 'product_id',
    },
  },
});
",
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { ProductSizes } from './ProductSizes';
import { Sellers } from './Sellers';

export class Countries {
  [PrimaryKeyProp]?: 'country';
  country!: unknown;
  productCountries = new Collection<ProductSizes>(this);
  sellerCountries = new Collection<Sellers>(this);
}

export const CountriesSchema = new EntitySchema({
  class: Countries,
  properties: {
    country: { primary: true, type: 'unknown', columnType: 'char(2)' },
    productCountries: {
      kind: 'm:n',
      entity: () => ProductSizes,
      pivotTable: 'product_countries',
      joinColumn: 'country',
      inverseJoinColumn: 'product_id',
    },
    sellerCountries: {
      kind: 'm:n',
      entity: () => Sellers,
      pivotTable: 'seller_countries',
      joinColumn: 'country',
      inverseJoinColumn: 'seller_id',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class ProductColors {
  [PrimaryKeyProp]?: ['colorId', 'productId', 'color', 'product'];
  colorId!: number;
  productId!: number;
  color!: Colors;
  product!: Products;
}

export const ProductColorsSchema = new EntitySchema({
  class: ProductColors,
  properties: {
    colorId: { primary: true, type: 'number', persist: false },
    productId: {
      primary: true,
      type: 'number',
      persist: false,
      index: 'fk_product_colors_products1_idx',
    },
    color: { primary: true, kind: 'm:1', entity: () => Colors, fieldName: 'color_id' },
    product: {
      primary: true,
      kind: 'm:1',
      entity: () => Products,
      fieldName: 'product_id',
      index: 'fk_product_colors_products1_idx',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class ProductSizes {
  [PrimaryKeyProp]?: ['productId', 'product'];
  productId!: number;
  size!: number;
  product!: Products;
}

export const ProductSizesSchema = new EntitySchema({
  class: ProductSizes,
  properties: {
    productId: { primary: true, type: 'number', persist: false },
    size: { type: 'number', columnType: 'smallint' },
    product: { primary: true, kind: '1:1', entity: () => Products, fieldName: 'product_id' },
  },
});
",
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { Sellers } from './Sellers';

export class Products {
  [PrimaryKeyProp]?: 'productId';
  productId!: number;
  name!: string;
  sellerProducts = new Collection<Sellers>(this);
}

export const ProductsSchema = new EntitySchema({
  class: Products,
  properties: {
    productId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
    sellerProducts: {
      kind: 'm:n',
      entity: () => Sellers,
      pivotTable: 'seller_products',
      pivotEntity: () => SellerProducts,
      joinColumn: 'product_id',
      inverseJoinColumn: 'seller_id',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Sales {
  [PrimaryKeyProp]?: 'saleId';
  saleId!: number;
  country!: unknown;
  sellerId!: number;
  productId!: number;
  colorId?: number;
  size?: number;
  exchangedProductId?: number;
  color?: ProductColors;
  productSizes?: ProductSizes;
  exchanged?: SellerProducts;
}

export const SalesSchema = new EntitySchema({
  class: Sales,
  indexes: [
    { name: 'fk_sales_product_countries1_idx', expression: 'create index \`fk_sales_product_countries1_idx\` on \`sales\` (\`country\`, \`product_id\`)' },
    { name: 'fk_sales_seller_countries1_idx', expression: 'create index \`fk_sales_seller_countries1_idx\` on \`sales\` (\`country\`, \`seller_id\`)' },
    { name: 'fk_sales_seller_products1_idx', expression: 'create index \`fk_sales_seller_products1_idx\` on \`sales\` (\`seller_id\`, \`product_id\`)' },
  ],
  uniques: [
    { name: 'product_id__size__color_id-UNIQUE', properties: ['colorId', 'productSizes'] },
  ],
  properties: {
    saleId: { primary: true, type: 'number' },
    country: { type: 'unknown', columnType: 'char(2)', persist: false },
    sellerId: { type: 'number', persist: false },
    productId: { type: 'number', persist: false, index: 'product_id_idx' },
    colorId: { type: 'number', nullable: true, persist: false },
    size: { type: 'number', columnType: 'smallint', nullable: true, persist: false },
    exchangedProductId: { type: 'number', nullable: true, persist: false },
    color: {
      kind: 'm:1',
      entity: () => ProductColors,
      fieldNames: [
        'color_id',
        'product_id'
      ],
      nullable: true,
      index: 'fk_sales_product_colors1_idx',
    },
    productSizes: {
      kind: 'm:1',
      entity: () => ProductSizes,
      fieldNames: [
        'size',
        'product_id'
      ],
      nullable: true,
      index: 'fk_sales_product_sizes1_idx',
    },
    exchanged: {
      kind: 'm:1',
      entity: () => SellerProducts,
      fieldNames: [
        'seller_id',
        'exchanged_product_id'
      ],
      nullable: true,
      index: 'fk_sales_seller_products2_idx',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class SellerProducts {
  [PrimaryKeyProp]?: ['sellerId', 'productId', 'product', 'seller'];
  sellerId!: number;
  productId!: number;
  product!: Products;
  seller!: Sellers;
}

export const SellerProductsSchema = new EntitySchema({
  class: SellerProducts,
  properties: {
    sellerId: { primary: true, type: 'number', persist: false },
    productId: {
      primary: true,
      type: 'number',
      persist: false,
      index: 'fk_seller_products_products1_idx',
    },
    product: {
      primary: true,
      kind: 'm:1',
      entity: () => Products,
      fieldName: 'product_id',
      index: 'fk_seller_products_products1_idx',
    },
    seller: { primary: true, kind: 'm:1', entity: () => Sellers, fieldName: 'seller_id' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Sellers {
  [PrimaryKeyProp]?: 'sellerId';
  sellerId!: number;
  name!: string;
}

export const SellersSchema = new EntitySchema({
  class: Sellers,
  properties: {
    sellerId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
  },
});
",
]
`;

exports[`4898 ambiguous_fk_example scalarPropertiesForRelations=never entitySchema=false: 4898 ambiguous_fk_example scalarPropertiesForRelations=never entitySchema=false 1`] = `
[
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';
import { ProductColors } from './ProductColors';
import { Products } from './Products';

@Entity()
export class Colors {

  [PrimaryKeyProp]?: 'colorId';

  @PrimaryKey()
  colorId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

  @ManyToMany({ entity: () => Products, pivotTable: 'product_colors', pivotEntity: () => ProductColors, joinColumn: 'color_id', inverseJoinColumn: 'product_id' })
  productColors = new Collection<Products>(this);

}
",
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';
import { ProductSizes } from './ProductSizes';
import { Sellers } from './Sellers';

@Entity()
export class Countries {

  [PrimaryKeyProp]?: 'country';

  @PrimaryKey({ columnType: 'char(2)' })
  country!: unknown;

  @ManyToMany({ entity: () => ProductSizes, pivotTable: 'product_countries', joinColumn: 'country', inverseJoinColumn: 'product_id' })
  productCountries = new Collection<ProductSizes>(this);

  @ManyToMany({ entity: () => Sellers, pivotTable: 'seller_countries', joinColumn: 'country', inverseJoinColumn: 'seller_id' })
  sellerCountries = new Collection<Sellers>(this);

}
",
  "import { Entity, ManyToOne, PrimaryKeyProp } from '@mikro-orm/core';
import { Colors } from './Colors';
import { Products } from './Products';

@Entity()
export class ProductColors {

  [PrimaryKeyProp]?: ['color', 'product'];

  @ManyToOne({ entity: () => Colors, fieldName: 'color_id', primary: true })
  color!: Colors;

  @ManyToOne({ entity: () => Products, fieldName: 'product_id', primary: true, index: 'fk_product_colors_products1_idx' })
  product!: Products;

}
",
  "import { Entity, OneToOne, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';
import { Products } from './Products';

@Entity()
@Unique({ name: 'size__product_id-UNIQUE', properties: ['size', 'product'] })
export class ProductSizes {

  [PrimaryKeyProp]?: 'product';

  @OneToOne({ entity: () => Products, fieldName: 'product_id', primary: true })
  product!: Products;

  @Property({ columnType: 'smallint' })
  size!: number;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Products {

  [PrimaryKeyProp]?: 'productId';

  @PrimaryKey()
  productId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

}
",
  "import { Entity, Index, ManyToOne, PrimaryKey, PrimaryKeyProp, Unique } from '@mikro-orm/core';
import { ProductColors } from './ProductColors';
import { ProductSizes } from './ProductSizes';
import { SellerProducts } from './SellerProducts';

@Entity()
@Index({ name: 'fk_sales_product_countries1_idx', expression: 'create index \`fk_sales_product_countries1_idx\` on \`sales\` (\`country\`, \`product_id\`)')
@Index({ name: 'fk_sales_seller_countries1_idx', expression: 'create index \`fk_sales_seller_countries1_idx\` on \`sales\` (\`country\`, \`seller_id\`)')
@Index({ name: 'fk_sales_seller_products1_idx', expression: 'create index \`fk_sales_seller_products1_idx\` on \`sales\` (\`seller_id\`, \`product_id\`)')
@Index({ name: 'product_id_idx', expression: 'create index \`product_id_idx\` on \`sales\` (\`product_id\`)')
@Unique({ name: 'product_id__size__color_id-UNIQUE', expression: 'create unique index \`product_id__size__color_id-UNIQUE\` on \`sales\` (\`product_id\`, \`color_id\`, \`size\`)')
export class Sales {

  [PrimaryKeyProp]?: 'saleId';

  @PrimaryKey()
  saleId!: number;

  @ManyToOne({ entity: () => ProductColors, fieldNames: ['color_id', 'product_id'], nullable: true, index: 'fk_sales_product_colors1_idx' })
  color?: ProductColors;

  @ManyToOne({ entity: () => ProductSizes, fieldNames: ['size', 'product_id'], nullable: true, index: 'fk_sales_product_sizes1_idx' })
  size?: ProductSizes;

  @ManyToOne({ entity: () => SellerProducts, fieldNames: ['seller_id', 'exchanged_product_id'], nullable: true, index: 'fk_sales_seller_products2_idx' })
  exchanged?: SellerProducts;

}
",
  "import { Entity, ManyToOne, PrimaryKeyProp } from '@mikro-orm/core';
import { Products } from './Products';
import { Sellers } from './Sellers';

@Entity()
export class SellerProducts {

  [PrimaryKeyProp]?: ['seller', 'product'];

  @ManyToOne({ entity: () => Sellers, fieldName: 'seller_id', primary: true })
  seller!: Sellers;

  @ManyToOne({ entity: () => Products, fieldName: 'product_id', primary: true, index: 'fk_seller_products_products1_idx' })
  product!: Products;

}
",
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';
import { Products } from './Products';
import { SellerProducts } from './SellerProducts';

@Entity()
export class Sellers {

  [PrimaryKeyProp]?: 'sellerId';

  @PrimaryKey()
  sellerId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

  @ManyToMany({ entity: () => Products, pivotTable: 'seller_products', pivotEntity: () => SellerProducts, joinColumn: 'seller_id', inverseJoinColumn: 'product_id' })
  sellerProducts = new Collection<Products>(this);

}
",
]
`;

exports[`4898 ambiguous_fk_example scalarPropertiesForRelations=never entitySchema=true: 4898 ambiguous_fk_example scalarPropertiesForRelations=never entitySchema=true 1`] = `
[
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { Products } from './Products';

export class Colors {
  [PrimaryKeyProp]?: 'colorId';
  colorId!: number;
  name!: string;
  productColors = new Collection<Products>(this);
}

export const ColorsSchema = new EntitySchema({
  class: Colors,
  properties: {
    colorId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
    productColors: {
      kind: 'm:n',
      entity: () => Products,
      pivotTable: 'product_colors',
      pivotEntity: () => ProductColors,
      joinColumn: 'color_id',
      inverseJoinColumn: 'product_id',
    },
  },
});
",
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { ProductSizes } from './ProductSizes';
import { Sellers } from './Sellers';

export class Countries {
  [PrimaryKeyProp]?: 'country';
  country!: unknown;
  productCountries = new Collection<ProductSizes>(this);
  sellerCountries = new Collection<Sellers>(this);
}

export const CountriesSchema = new EntitySchema({
  class: Countries,
  properties: {
    country: { primary: true, type: 'unknown', columnType: 'char(2)' },
    productCountries: {
      kind: 'm:n',
      entity: () => ProductSizes,
      pivotTable: 'product_countries',
      joinColumn: 'country',
      inverseJoinColumn: 'product_id',
    },
    sellerCountries: {
      kind: 'm:n',
      entity: () => Sellers,
      pivotTable: 'seller_countries',
      joinColumn: 'country',
      inverseJoinColumn: 'seller_id',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class ProductColors {
  [PrimaryKeyProp]?: ['color', 'product'];
  color!: Colors;
  product!: Products;
}

export const ProductColorsSchema = new EntitySchema({
  class: ProductColors,
  properties: {
    color: { primary: true, kind: 'm:1', entity: () => Colors, fieldName: 'color_id' },
    product: {
      primary: true,
      kind: 'm:1',
      entity: () => Products,
      fieldName: 'product_id',
      index: 'fk_product_colors_products1_idx',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class ProductSizes {
  [PrimaryKeyProp]?: 'product';
  product!: Products;
  size!: number;
}

export const ProductSizesSchema = new EntitySchema({
  class: ProductSizes,
  properties: {
    product: { primary: true, kind: '1:1', entity: () => Products, fieldName: 'product_id' },
    size: { type: 'number', columnType: 'smallint' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Products {
  [PrimaryKeyProp]?: 'productId';
  productId!: number;
  name!: string;
}

export const ProductsSchema = new EntitySchema({
  class: Products,
  properties: {
    productId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Sales {
  [PrimaryKeyProp]?: 'saleId';
  saleId!: number;
  color?: ProductColors;
  size?: ProductSizes;
  exchanged?: SellerProducts;
}

export const SalesSchema = new EntitySchema({
  class: Sales,
  indexes: [
    { name: 'fk_sales_product_countries1_idx', expression: 'create index \`fk_sales_product_countries1_idx\` on \`sales\` (\`country\`, \`product_id\`)' },
    { name: 'fk_sales_seller_countries1_idx', expression: 'create index \`fk_sales_seller_countries1_idx\` on \`sales\` (\`country\`, \`seller_id\`)' },
    { name: 'fk_sales_seller_products1_idx', expression: 'create index \`fk_sales_seller_products1_idx\` on \`sales\` (\`seller_id\`, \`product_id\`)' },
    { name: 'product_id_idx', expression: 'create index \`product_id_idx\` on \`sales\` (\`product_id\`)' },
  ],
  uniques: [
    { name: 'product_id__size__color_id-UNIQUE', expression: 'create unique index \`product_id__size__color_id-UNIQUE\` on \`sales\` (\`product_id\`, \`color_id\`, \`size\`)' },
  ],
  properties: {
    saleId: { primary: true, type: 'number' },
    color: {
      kind: 'm:1',
      entity: () => ProductColors,
      fieldNames: [
        'color_id',
        'product_id'
      ],
      nullable: true,
      index: 'fk_sales_product_colors1_idx',
    },
    size: {
      kind: 'm:1',
      entity: () => ProductSizes,
      fieldNames: [
        'size',
        'product_id'
      ],
      nullable: true,
      index: 'fk_sales_product_sizes1_idx',
    },
    exchanged: {
      kind: 'm:1',
      entity: () => SellerProducts,
      fieldNames: [
        'seller_id',
        'exchanged_product_id'
      ],
      nullable: true,
      index: 'fk_sales_seller_products2_idx',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class SellerProducts {
  [PrimaryKeyProp]?: ['seller', 'product'];
  seller!: Sellers;
  product!: Products;
}

export const SellerProductsSchema = new EntitySchema({
  class: SellerProducts,
  properties: {
    seller: { primary: true, kind: 'm:1', entity: () => Sellers, fieldName: 'seller_id' },
    product: {
      primary: true,
      kind: 'm:1',
      entity: () => Products,
      fieldName: 'product_id',
      index: 'fk_seller_products_products1_idx',
    },
  },
});
",
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { Products } from './Products';

export class Sellers {
  [PrimaryKeyProp]?: 'sellerId';
  sellerId!: number;
  name!: string;
  sellerProducts = new Collection<Products>(this);
}

export const SellersSchema = new EntitySchema({
  class: Sellers,
  properties: {
    sellerId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
    sellerProducts: {
      kind: 'm:n',
      entity: () => Products,
      pivotTable: 'seller_products',
      pivotEntity: () => SellerProducts,
      joinColumn: 'seller_id',
      inverseJoinColumn: 'product_id',
    },
  },
});
",
]
`;

exports[`4898 ambiguous_fk_example scalarPropertiesForRelations=smart entitySchema=false: 4898 ambiguous_fk_example scalarPropertiesForRelations=smart entitySchema=false 1`] = `
[
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';
import { ProductColors } from './ProductColors';
import { Products } from './Products';

@Entity()
export class Colors {

  [PrimaryKeyProp]?: 'colorId';

  @PrimaryKey()
  colorId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

  @ManyToMany({ entity: () => Products, pivotTable: 'product_colors', pivotEntity: () => ProductColors, joinColumn: 'color_id', inverseJoinColumn: 'product_id' })
  productColors = new Collection<Products>(this);

}
",
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';
import { ProductSizes } from './ProductSizes';
import { Sellers } from './Sellers';

@Entity()
export class Countries {

  [PrimaryKeyProp]?: 'country';

  @PrimaryKey({ columnType: 'char(2)' })
  country!: unknown;

  @ManyToMany({ entity: () => ProductSizes, pivotTable: 'product_countries', joinColumn: 'country', inverseJoinColumn: 'product_id' })
  productCountries = new Collection<ProductSizes>(this);

  @ManyToMany({ entity: () => Sellers, pivotTable: 'seller_countries', joinColumn: 'country', inverseJoinColumn: 'seller_id' })
  sellerCountries = new Collection<Sellers>(this);

}
",
  "import { Entity, ManyToOne, PrimaryKeyProp } from '@mikro-orm/core';
import { Colors } from './Colors';
import { Products } from './Products';

@Entity()
export class ProductColors {

  [PrimaryKeyProp]?: ['color', 'product'];

  @ManyToOne({ entity: () => Colors, fieldName: 'color_id', primary: true })
  color!: Colors;

  @ManyToOne({ entity: () => Products, fieldName: 'product_id', primary: true, index: 'fk_product_colors_products1_idx' })
  product!: Products;

}
",
  "import { Entity, OneToOne, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';
import { Products } from './Products';

@Entity()
@Unique({ name: 'size__product_id-UNIQUE', properties: ['size', 'product'] })
export class ProductSizes {

  [PrimaryKeyProp]?: 'product';

  @OneToOne({ entity: () => Products, fieldName: 'product_id', primary: true })
  product!: Products;

  @Property({ columnType: 'smallint' })
  size!: number;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Products {

  [PrimaryKeyProp]?: 'productId';

  @PrimaryKey()
  productId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

}
",
  "import { Entity, Index, ManyToOne, PrimaryKey, PrimaryKeyProp, Unique } from '@mikro-orm/core';
import { ProductColors } from './ProductColors';
import { ProductSizes } from './ProductSizes';
import { SellerProducts } from './SellerProducts';

@Entity()
@Index({ name: 'fk_sales_product_countries1_idx', expression: 'create index \`fk_sales_product_countries1_idx\` on \`sales\` (\`country\`, \`product_id\`)')
@Index({ name: 'fk_sales_seller_countries1_idx', expression: 'create index \`fk_sales_seller_countries1_idx\` on \`sales\` (\`country\`, \`seller_id\`)')
@Index({ name: 'fk_sales_seller_products1_idx', expression: 'create index \`fk_sales_seller_products1_idx\` on \`sales\` (\`seller_id\`, \`product_id\`)')
@Index({ name: 'product_id_idx', expression: 'create index \`product_id_idx\` on \`sales\` (\`product_id\`)')
@Unique({ name: 'product_id__size__color_id-UNIQUE', expression: 'create unique index \`product_id__size__color_id-UNIQUE\` on \`sales\` (\`product_id\`, \`color_id\`, \`size\`)')
export class Sales {

  [PrimaryKeyProp]?: 'saleId';

  @PrimaryKey()
  saleId!: number;

  @ManyToOne({ entity: () => ProductColors, fieldNames: ['color_id', 'product_id'], nullable: true, index: 'fk_sales_product_colors1_idx' })
  color?: ProductColors;

  @ManyToOne({ entity: () => ProductSizes, fieldNames: ['size', 'product_id'], nullable: true, index: 'fk_sales_product_sizes1_idx' })
  size?: ProductSizes;

  @ManyToOne({ entity: () => SellerProducts, fieldNames: ['seller_id', 'exchanged_product_id'], nullable: true, index: 'fk_sales_seller_products2_idx' })
  exchanged?: SellerProducts;

}
",
  "import { Entity, ManyToOne, PrimaryKeyProp } from '@mikro-orm/core';
import { Products } from './Products';
import { Sellers } from './Sellers';

@Entity()
export class SellerProducts {

  [PrimaryKeyProp]?: ['seller', 'product'];

  @ManyToOne({ entity: () => Sellers, fieldName: 'seller_id', primary: true })
  seller!: Sellers;

  @ManyToOne({ entity: () => Products, fieldName: 'product_id', primary: true, index: 'fk_seller_products_products1_idx' })
  product!: Products;

}
",
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';
import { Products } from './Products';
import { SellerProducts } from './SellerProducts';

@Entity()
export class Sellers {

  [PrimaryKeyProp]?: 'sellerId';

  @PrimaryKey()
  sellerId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

  @ManyToMany({ entity: () => Products, pivotTable: 'seller_products', pivotEntity: () => SellerProducts, joinColumn: 'seller_id', inverseJoinColumn: 'product_id' })
  sellerProducts = new Collection<Products>(this);

}
",
]
`;

exports[`4898 ambiguous_fk_example scalarPropertiesForRelations=smart entitySchema=true: 4898 ambiguous_fk_example scalarPropertiesForRelations=smart entitySchema=true 1`] = `
[
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { Products } from './Products';

export class Colors {
  [PrimaryKeyProp]?: 'colorId';
  colorId!: number;
  name!: string;
  productColors = new Collection<Products>(this);
}

export const ColorsSchema = new EntitySchema({
  class: Colors,
  properties: {
    colorId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
    productColors: {
      kind: 'm:n',
      entity: () => Products,
      pivotTable: 'product_colors',
      pivotEntity: () => ProductColors,
      joinColumn: 'color_id',
      inverseJoinColumn: 'product_id',
    },
  },
});
",
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { ProductSizes } from './ProductSizes';
import { Sellers } from './Sellers';

export class Countries {
  [PrimaryKeyProp]?: 'country';
  country!: unknown;
  productCountries = new Collection<ProductSizes>(this);
  sellerCountries = new Collection<Sellers>(this);
}

export const CountriesSchema = new EntitySchema({
  class: Countries,
  properties: {
    country: { primary: true, type: 'unknown', columnType: 'char(2)' },
    productCountries: {
      kind: 'm:n',
      entity: () => ProductSizes,
      pivotTable: 'product_countries',
      joinColumn: 'country',
      inverseJoinColumn: 'product_id',
    },
    sellerCountries: {
      kind: 'm:n',
      entity: () => Sellers,
      pivotTable: 'seller_countries',
      joinColumn: 'country',
      inverseJoinColumn: 'seller_id',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class ProductColors {
  [PrimaryKeyProp]?: ['color', 'product'];
  color!: Colors;
  product!: Products;
}

export const ProductColorsSchema = new EntitySchema({
  class: ProductColors,
  properties: {
    color: { primary: true, kind: 'm:1', entity: () => Colors, fieldName: 'color_id' },
    product: {
      primary: true,
      kind: 'm:1',
      entity: () => Products,
      fieldName: 'product_id',
      index: 'fk_product_colors_products1_idx',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class ProductSizes {
  [PrimaryKeyProp]?: 'product';
  product!: Products;
  size!: number;
}

export const ProductSizesSchema = new EntitySchema({
  class: ProductSizes,
  properties: {
    product: { primary: true, kind: '1:1', entity: () => Products, fieldName: 'product_id' },
    size: { type: 'number', columnType: 'smallint' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Products {
  [PrimaryKeyProp]?: 'productId';
  productId!: number;
  name!: string;
}

export const ProductsSchema = new EntitySchema({
  class: Products,
  properties: {
    productId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Sales {
  [PrimaryKeyProp]?: 'saleId';
  saleId!: number;
  color?: ProductColors;
  size?: ProductSizes;
  exchanged?: SellerProducts;
}

export const SalesSchema = new EntitySchema({
  class: Sales,
  indexes: [
    { name: 'fk_sales_product_countries1_idx', expression: 'create index \`fk_sales_product_countries1_idx\` on \`sales\` (\`country\`, \`product_id\`)' },
    { name: 'fk_sales_seller_countries1_idx', expression: 'create index \`fk_sales_seller_countries1_idx\` on \`sales\` (\`country\`, \`seller_id\`)' },
    { name: 'fk_sales_seller_products1_idx', expression: 'create index \`fk_sales_seller_products1_idx\` on \`sales\` (\`seller_id\`, \`product_id\`)' },
    { name: 'product_id_idx', expression: 'create index \`product_id_idx\` on \`sales\` (\`product_id\`)' },
  ],
  uniques: [
    { name: 'product_id__size__color_id-UNIQUE', expression: 'create unique index \`product_id__size__color_id-UNIQUE\` on \`sales\` (\`product_id\`, \`color_id\`, \`size\`)' },
  ],
  properties: {
    saleId: { primary: true, type: 'number' },
    color: {
      kind: 'm:1',
      entity: () => ProductColors,
      fieldNames: [
        'color_id',
        'product_id'
      ],
      nullable: true,
      index: 'fk_sales_product_colors1_idx',
    },
    size: {
      kind: 'm:1',
      entity: () => ProductSizes,
      fieldNames: [
        'size',
        'product_id'
      ],
      nullable: true,
      index: 'fk_sales_product_sizes1_idx',
    },
    exchanged: {
      kind: 'm:1',
      entity: () => SellerProducts,
      fieldNames: [
        'seller_id',
        'exchanged_product_id'
      ],
      nullable: true,
      index: 'fk_sales_seller_products2_idx',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class SellerProducts {
  [PrimaryKeyProp]?: ['seller', 'product'];
  seller!: Sellers;
  product!: Products;
}

export const SellerProductsSchema = new EntitySchema({
  class: SellerProducts,
  properties: {
    seller: { primary: true, kind: 'm:1', entity: () => Sellers, fieldName: 'seller_id' },
    product: {
      primary: true,
      kind: 'm:1',
      entity: () => Products,
      fieldName: 'product_id',
      index: 'fk_seller_products_products1_idx',
    },
  },
});
",
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { Products } from './Products';

export class Sellers {
  [PrimaryKeyProp]?: 'sellerId';
  sellerId!: number;
  name!: string;
  sellerProducts = new Collection<Products>(this);
}

export const SellersSchema = new EntitySchema({
  class: Sellers,
  properties: {
    sellerId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
    sellerProducts: {
      kind: 'm:n',
      entity: () => Products,
      pivotTable: 'seller_products',
      pivotEntity: () => SellerProducts,
      joinColumn: 'seller_id',
      inverseJoinColumn: 'product_id',
    },
  },
});
",
]
`;

exports[`4898 fk_index_selection_example scalarPropertiesForRelations=always entitySchema=false: 4898 fk_index_selection_example scalarPropertiesForRelations=always entitySchema=false 1`] = `
[
  "import { Entity, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';

@Entity()
export class Cars {

  [PrimaryKeyProp]?: ['carBrand', 'carYear'];

  @PrimaryKey({ length: 255 })
  carBrand!: string;

  @PrimaryKey({ columnType: 'year' })
  carYear!: unknown;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';

@Entity()
export class FashionableColors {

  [PrimaryKeyProp]?: ['year', 'color'];

  @PrimaryKey({ columnType: 'year' })
  year!: unknown;

  @PrimaryKey({ length: 255 })
  color!: string;

}
",
  "import { Entity, Index, ManyToOne, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { FashionableColors } from './FashionableColors';

@Entity()
@Index({ name: 'favorites_idx', properties: ['favoriteColor', 'favoriteBook'] })
export class Users {

  [PrimaryKeyProp]?: 'userId';

  @PrimaryKey()
  userId!: number;

  @Index({ name: 'fk_users_cars_idx' })
  @Property({ length: 255, nullable: true, persist: false })
  favoriteCarBrand?: string;

  @Property({ columnType: 'year', nullable: true, persist: false })
  favoriteCarYear?: unknown;

  @Property({ length: 255, nullable: true, persist: false })
  favoriteColor?: string;

  @Property({ length: 255, nullable: true })
  favoriteBook?: string;

  @ManyToOne({ entity: () => FashionableColors, fieldNames: ['favorite_car_year', 'favorite_color'], nullable: true, index: 'fk_users_fashionable_colors1_idx' })
  favorite?: FashionableColors;

}
",
]
`;

exports[`4898 fk_index_selection_example scalarPropertiesForRelations=always entitySchema=true: 4898 fk_index_selection_example scalarPropertiesForRelations=always entitySchema=true 1`] = `
[
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Cars {
  [PrimaryKeyProp]?: ['carBrand', 'carYear'];
  carBrand!: string;
  carYear!: unknown;
}

export const CarsSchema = new EntitySchema({
  class: Cars,
  properties: {
    carBrand: { primary: true, type: 'string', length: 255 },
    carYear: { primary: true, type: 'unknown', columnType: 'year' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class FashionableColors {
  [PrimaryKeyProp]?: ['year', 'color'];
  year!: unknown;
  color!: string;
}

export const FashionableColorsSchema = new EntitySchema({
  class: FashionableColors,
  properties: {
    year: { primary: true, type: 'unknown', columnType: 'year' },
    color: { primary: true, type: 'string', length: 255 },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Users {
  [PrimaryKeyProp]?: 'userId';
  userId!: number;
  favoriteCarBrand?: string;
  favoriteCarYear?: unknown;
  favoriteColor?: string;
  favoriteBook?: string;
  favorite?: FashionableColors;
}

export const UsersSchema = new EntitySchema({
  class: Users,
  indexes: [
    { name: 'favorites_idx', properties: ['favoriteColor', 'favoriteBook'] },
  ],
  uniques: [
  ],
  properties: {
    userId: { primary: true, type: 'number' },
    favoriteCarBrand: {
      type: 'string',
      length: 255,
      nullable: true,
      persist: false,
      index: 'fk_users_cars_idx',
    },
    favoriteCarYear: { type: 'unknown', columnType: 'year', nullable: true, persist: false },
    favoriteColor: { type: 'string', length: 255, nullable: true, persist: false },
    favoriteBook: { type: 'string', length: 255, nullable: true },
    favorite: {
      kind: 'm:1',
      entity: () => FashionableColors,
      fieldNames: [
        'favorite_car_year',
        'favorite_color'
      ],
      nullable: true,
      index: 'fk_users_fashionable_colors1_idx',
    },
  },
});
",
]
`;

exports[`4898 fk_index_selection_example scalarPropertiesForRelations=never entitySchema=false: 4898 fk_index_selection_example scalarPropertiesForRelations=never entitySchema=false 1`] = `
[
  "import { Entity, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';

@Entity()
export class Cars {

  [PrimaryKeyProp]?: ['carBrand', 'carYear'];

  @PrimaryKey({ length: 255 })
  carBrand!: string;

  @PrimaryKey({ columnType: 'year' })
  carYear!: unknown;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';

@Entity()
export class FashionableColors {

  [PrimaryKeyProp]?: ['year', 'color'];

  @PrimaryKey({ columnType: 'year' })
  year!: unknown;

  @PrimaryKey({ length: 255 })
  color!: string;

}
",
  "import { Entity, Index, OneToOne, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { FashionableColors } from './FashionableColors';

@Entity()
@Index({ name: 'favorites_idx', expression: 'create index \`favorites_idx\` on \`users\` (\`favorite_car_year\`, \`favorite_color\`, \`favorite_book\`)')
@Index({ name: 'fk_users_cars_idx', expression: 'create index \`fk_users_cars_idx\` on \`users\` (\`favorite_car_brand\`, \`favorite_car_year\`)')
export class Users {

  [PrimaryKeyProp]?: 'userId';

  @PrimaryKey()
  userId!: number;

  @OneToOne({ entity: () => FashionableColors, fieldNames: ['favorite_car_year', 'favorite_color'], nullable: true, index: 'fk_users_fashionable_colors1_idx', unique: 'when_set_unique' })
  favorite?: FashionableColors;

  @Property({ length: 255, nullable: true })
  favoriteBook?: string;

}
",
]
`;

exports[`4898 fk_index_selection_example scalarPropertiesForRelations=never entitySchema=true: 4898 fk_index_selection_example scalarPropertiesForRelations=never entitySchema=true 1`] = `
[
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Cars {
  [PrimaryKeyProp]?: ['carBrand', 'carYear'];
  carBrand!: string;
  carYear!: unknown;
}

export const CarsSchema = new EntitySchema({
  class: Cars,
  properties: {
    carBrand: { primary: true, type: 'string', length: 255 },
    carYear: { primary: true, type: 'unknown', columnType: 'year' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class FashionableColors {
  [PrimaryKeyProp]?: ['year', 'color'];
  year!: unknown;
  color!: string;
}

export const FashionableColorsSchema = new EntitySchema({
  class: FashionableColors,
  properties: {
    year: { primary: true, type: 'unknown', columnType: 'year' },
    color: { primary: true, type: 'string', length: 255 },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Users {
  [PrimaryKeyProp]?: 'userId';
  userId!: number;
  favorite?: FashionableColors;
  favoriteBook?: string;
}

export const UsersSchema = new EntitySchema({
  class: Users,
  indexes: [
    { name: 'favorites_idx', expression: 'create index \`favorites_idx\` on \`users\` (\`favorite_car_year\`, \`favorite_color\`, \`favorite_book\`)' },
    { name: 'fk_users_cars_idx', expression: 'create index \`fk_users_cars_idx\` on \`users\` (\`favorite_car_brand\`, \`favorite_car_year\`)' },
  ],
  uniques: [
  ],
  properties: {
    userId: { primary: true, type: 'number' },
    favorite: {
      kind: '1:1',
      entity: () => FashionableColors,
      fieldNames: [
        'favorite_car_year',
        'favorite_color'
      ],
      nullable: true,
      index: 'fk_users_fashionable_colors1_idx',
      unique: 'when_set_unique',
    },
    favoriteBook: { type: 'string', length: 255, nullable: true },
  },
});
",
]
`;

exports[`4898 fk_index_selection_example scalarPropertiesForRelations=smart entitySchema=false: 4898 fk_index_selection_example scalarPropertiesForRelations=smart entitySchema=false 1`] = `
[
  "import { Entity, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';

@Entity()
export class Cars {

  [PrimaryKeyProp]?: ['carBrand', 'carYear'];

  @PrimaryKey({ length: 255 })
  carBrand!: string;

  @PrimaryKey({ columnType: 'year' })
  carYear!: unknown;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';

@Entity()
export class FashionableColors {

  [PrimaryKeyProp]?: ['year', 'color'];

  @PrimaryKey({ columnType: 'year' })
  year!: unknown;

  @PrimaryKey({ length: 255 })
  color!: string;

}
",
  "import { Entity, Index, OneToOne, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { FashionableColors } from './FashionableColors';

@Entity()
@Index({ name: 'favorites_idx', expression: 'create index \`favorites_idx\` on \`users\` (\`favorite_car_year\`, \`favorite_color\`, \`favorite_book\`)')
@Index({ name: 'fk_users_cars_idx', expression: 'create index \`fk_users_cars_idx\` on \`users\` (\`favorite_car_brand\`, \`favorite_car_year\`)')
export class Users {

  [PrimaryKeyProp]?: 'userId';

  @PrimaryKey()
  userId!: number;

  @OneToOne({ entity: () => FashionableColors, fieldNames: ['favorite_car_year', 'favorite_color'], nullable: true, index: 'fk_users_fashionable_colors1_idx', unique: 'when_set_unique' })
  favorite?: FashionableColors;

  @Property({ columnType: 'year', nullable: true, persist: false })
  favoriteCarYear?: unknown;

  @Property({ length: 255, nullable: true })
  favoriteBook?: string;

}
",
]
`;

exports[`4898 fk_index_selection_example scalarPropertiesForRelations=smart entitySchema=true: 4898 fk_index_selection_example scalarPropertiesForRelations=smart entitySchema=true 1`] = `
[
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Cars {
  [PrimaryKeyProp]?: ['carBrand', 'carYear'];
  carBrand!: string;
  carYear!: unknown;
}

export const CarsSchema = new EntitySchema({
  class: Cars,
  properties: {
    carBrand: { primary: true, type: 'string', length: 255 },
    carYear: { primary: true, type: 'unknown', columnType: 'year' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class FashionableColors {
  [PrimaryKeyProp]?: ['year', 'color'];
  year!: unknown;
  color!: string;
}

export const FashionableColorsSchema = new EntitySchema({
  class: FashionableColors,
  properties: {
    year: { primary: true, type: 'unknown', columnType: 'year' },
    color: { primary: true, type: 'string', length: 255 },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Users {
  [PrimaryKeyProp]?: 'userId';
  userId!: number;
  favorite?: FashionableColors;
  favoriteCarYear?: unknown;
  favoriteBook?: string;
}

export const UsersSchema = new EntitySchema({
  class: Users,
  indexes: [
    { name: 'favorites_idx', expression: 'create index \`favorites_idx\` on \`users\` (\`favorite_car_year\`, \`favorite_color\`, \`favorite_book\`)' },
    { name: 'fk_users_cars_idx', expression: 'create index \`fk_users_cars_idx\` on \`users\` (\`favorite_car_brand\`, \`favorite_car_year\`)' },
  ],
  uniques: [
  ],
  properties: {
    userId: { primary: true, type: 'number' },
    favorite: {
      kind: '1:1',
      entity: () => FashionableColors,
      fieldNames: [
        'favorite_car_year',
        'favorite_color'
      ],
      nullable: true,
      index: 'fk_users_fashionable_colors1_idx',
      unique: 'when_set_unique',
    },
    favoriteCarYear: { type: 'unknown', columnType: 'year', nullable: true, persist: false },
    favoriteBook: { type: 'string', length: 255, nullable: true },
  },
});
",
]
`;

exports[`4898 non_composite_ambiguous_fk_example scalarPropertiesForRelations=always entitySchema=false: 4898 non_composite_ambiguous_fk_example scalarPropertiesForRelations=always entitySchema=false 1`] = `
[
  "import { Entity, OneToOne, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Products } from './Products';

@Entity()
export class DeliverableProducts {

  [PrimaryKeyProp]?: ['productId', 'product'];

  @PrimaryKey({ persist: false })
  productId!: number;

  @Property({ length: 0 })
  startingAt!: Date;

  @OneToOne({ entity: () => Products, fieldName: 'product_id', primary: true })
  product!: Products;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Destinations {

  [PrimaryKeyProp]?: 'destinationId';

  @PrimaryKey()
  destinationId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

}
",
  "import { Entity, OneToOne, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Products } from './Products';

@Entity()
export class ManufacturedProducts {

  [PrimaryKeyProp]?: ['productId', 'product'];

  @PrimaryKey({ persist: false })
  productId!: number;

  @Property({ length: 255 })
  place!: string;

  @OneToOne({ entity: () => Products, fieldName: 'product_id', primary: true })
  product!: Products;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';

@Entity()
export class Products {

  [PrimaryKeyProp]?: 'productId';

  @PrimaryKey()
  productId!: number;

  @Property({ length: 255 })
  name!: string;

}
",
  "import { Entity, Index, ManyToOne, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Destinations } from './Destinations';

@Entity()
export class ShippableProducts {

  [PrimaryKeyProp]?: 'productId';

  @PrimaryKey({ persist: false })
  productId!: number;

  @Index({ name: 'fk_shippable_products_destinations1_idx' })
  @Property({ length: 255, persist: false })
  destination!: string;

  @ManyToOne({ entity: () => Destinations, fieldName: 'destination', index: 'fk_shippable_products_destinations1_idx' })
  destinations!: Destinations;

}
",
]
`;

exports[`4898 non_composite_ambiguous_fk_example scalarPropertiesForRelations=always entitySchema=true: 4898 non_composite_ambiguous_fk_example scalarPropertiesForRelations=always entitySchema=true 1`] = `
[
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class DeliverableProducts {
  [PrimaryKeyProp]?: ['productId', 'product'];
  productId!: number;
  startingAt!: Date;
  product!: Products;
}

export const DeliverableProductsSchema = new EntitySchema({
  class: DeliverableProducts,
  properties: {
    productId: { primary: true, type: 'number', persist: false },
    startingAt: { type: 'Date', length: 0 },
    product: { primary: true, kind: '1:1', entity: () => Products, fieldName: 'product_id' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Destinations {
  [PrimaryKeyProp]?: 'destinationId';
  destinationId!: number;
  name!: string;
}

export const DestinationsSchema = new EntitySchema({
  class: Destinations,
  properties: {
    destinationId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class ManufacturedProducts {
  [PrimaryKeyProp]?: ['productId', 'product'];
  productId!: number;
  place!: string;
  product!: Products;
}

export const ManufacturedProductsSchema = new EntitySchema({
  class: ManufacturedProducts,
  properties: {
    productId: { primary: true, type: 'number', persist: false },
    place: { type: 'string', length: 255 },
    product: { primary: true, kind: '1:1', entity: () => Products, fieldName: 'product_id' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Products {
  [PrimaryKeyProp]?: 'productId';
  productId!: number;
  name!: string;
}

export const ProductsSchema = new EntitySchema({
  class: Products,
  properties: {
    productId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255 },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class ShippableProducts {
  [PrimaryKeyProp]?: 'productId';
  productId!: number;
  destination!: string;
  destinations!: Destinations;
}

export const ShippableProductsSchema = new EntitySchema({
  class: ShippableProducts,
  properties: {
    productId: { primary: true, type: 'number', persist: false },
    destination: {
      type: 'string',
      length: 255,
      persist: false,
      index: 'fk_shippable_products_destinations1_idx',
    },
    destinations: {
      kind: 'm:1',
      entity: () => Destinations,
      fieldName: 'destination',
      index: 'fk_shippable_products_destinations1_idx',
    },
  },
});
",
]
`;

exports[`4898 non_composite_ambiguous_fk_example scalarPropertiesForRelations=never entitySchema=false: 4898 non_composite_ambiguous_fk_example scalarPropertiesForRelations=never entitySchema=false 1`] = `
[
  "import { Entity, OneToOne, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Products } from './Products';

@Entity()
export class DeliverableProducts {

  [PrimaryKeyProp]?: 'product';

  @OneToOne({ entity: () => Products, fieldName: 'product_id', primary: true })
  product!: Products;

  @Property({ length: 0 })
  startingAt!: Date;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Destinations {

  [PrimaryKeyProp]?: 'destinationId';

  @PrimaryKey()
  destinationId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

}
",
  "import { Entity, OneToOne, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Products } from './Products';

@Entity()
export class ManufacturedProducts {

  [PrimaryKeyProp]?: 'product';

  @OneToOne({ entity: () => Products, fieldName: 'product_id', primary: true })
  product!: Products;

  @Property({ length: 255 })
  place!: string;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';

@Entity()
export class Products {

  [PrimaryKeyProp]?: 'productId';

  @PrimaryKey()
  productId!: number;

  @Property({ length: 255 })
  name!: string;

}
",
  "import { Entity, ManyToOne } from '@mikro-orm/core';
import { Destinations } from './Destinations';

@Entity()
export class ShippableProducts {

  @ManyToOne({ entity: () => Destinations, fieldName: 'destination', index: 'fk_shippable_products_destinations1_idx' })
  destination!: Destinations;

}
",
]
`;

exports[`4898 non_composite_ambiguous_fk_example scalarPropertiesForRelations=never entitySchema=true: 4898 non_composite_ambiguous_fk_example scalarPropertiesForRelations=never entitySchema=true 1`] = `
[
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class DeliverableProducts {
  [PrimaryKeyProp]?: 'product';
  product!: Products;
  startingAt!: Date;
}

export const DeliverableProductsSchema = new EntitySchema({
  class: DeliverableProducts,
  properties: {
    product: { primary: true, kind: '1:1', entity: () => Products, fieldName: 'product_id' },
    startingAt: { type: 'Date', length: 0 },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Destinations {
  [PrimaryKeyProp]?: 'destinationId';
  destinationId!: number;
  name!: string;
}

export const DestinationsSchema = new EntitySchema({
  class: Destinations,
  properties: {
    destinationId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class ManufacturedProducts {
  [PrimaryKeyProp]?: 'product';
  product!: Products;
  place!: string;
}

export const ManufacturedProductsSchema = new EntitySchema({
  class: ManufacturedProducts,
  properties: {
    product: { primary: true, kind: '1:1', entity: () => Products, fieldName: 'product_id' },
    place: { type: 'string', length: 255 },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Products {
  [PrimaryKeyProp]?: 'productId';
  productId!: number;
  name!: string;
}

export const ProductsSchema = new EntitySchema({
  class: Products,
  properties: {
    productId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255 },
  },
});
",
  "import { EntitySchema } from '@mikro-orm/core';

export class ShippableProducts {
  destination!: Destinations;
}

export const ShippableProductsSchema = new EntitySchema({
  class: ShippableProducts,
  properties: {
    destination: {
      kind: 'm:1',
      entity: () => Destinations,
      fieldName: 'destination',
      index: 'fk_shippable_products_destinations1_idx',
    },
  },
});
",
]
`;

exports[`4898 non_composite_ambiguous_fk_example scalarPropertiesForRelations=smart entitySchema=false: 4898 non_composite_ambiguous_fk_example scalarPropertiesForRelations=smart entitySchema=false 1`] = `
[
  "import { Entity, OneToOne, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Products } from './Products';

@Entity()
export class DeliverableProducts {

  [PrimaryKeyProp]?: 'product';

  @OneToOne({ entity: () => Products, fieldName: 'product_id', primary: true })
  product!: Products;

  @Property({ length: 0 })
  startingAt!: Date;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Destinations {

  [PrimaryKeyProp]?: 'destinationId';

  @PrimaryKey()
  destinationId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

}
",
  "import { Entity, OneToOne, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Products } from './Products';

@Entity()
export class ManufacturedProducts {

  [PrimaryKeyProp]?: 'product';

  @OneToOne({ entity: () => Products, fieldName: 'product_id', primary: true })
  product!: Products;

  @Property({ length: 255 })
  place!: string;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';

@Entity()
export class Products {

  [PrimaryKeyProp]?: 'productId';

  @PrimaryKey()
  productId!: number;

  @Property({ length: 255 })
  name!: string;

}
",
  "import { Entity, ManyToOne } from '@mikro-orm/core';
import { Destinations } from './Destinations';

@Entity()
export class ShippableProducts {

  @ManyToOne({ entity: () => Destinations, fieldName: 'destination', index: 'fk_shippable_products_destinations1_idx' })
  destination!: Destinations;

}
",
]
`;

exports[`4898 non_composite_ambiguous_fk_example scalarPropertiesForRelations=smart entitySchema=true: 4898 non_composite_ambiguous_fk_example scalarPropertiesForRelations=smart entitySchema=true 1`] = `
[
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class DeliverableProducts {
  [PrimaryKeyProp]?: 'product';
  product!: Products;
  startingAt!: Date;
}

export const DeliverableProductsSchema = new EntitySchema({
  class: DeliverableProducts,
  properties: {
    product: { primary: true, kind: '1:1', entity: () => Products, fieldName: 'product_id' },
    startingAt: { type: 'Date', length: 0 },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Destinations {
  [PrimaryKeyProp]?: 'destinationId';
  destinationId!: number;
  name!: string;
}

export const DestinationsSchema = new EntitySchema({
  class: Destinations,
  properties: {
    destinationId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class ManufacturedProducts {
  [PrimaryKeyProp]?: 'product';
  product!: Products;
  place!: string;
}

export const ManufacturedProductsSchema = new EntitySchema({
  class: ManufacturedProducts,
  properties: {
    product: { primary: true, kind: '1:1', entity: () => Products, fieldName: 'product_id' },
    place: { type: 'string', length: 255 },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Products {
  [PrimaryKeyProp]?: 'productId';
  productId!: number;
  name!: string;
}

export const ProductsSchema = new EntitySchema({
  class: Products,
  properties: {
    productId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255 },
  },
});
",
  "import { EntitySchema } from '@mikro-orm/core';

export class ShippableProducts {
  destination!: Destinations;
}

export const ShippableProductsSchema = new EntitySchema({
  class: ShippableProducts,
  properties: {
    destination: {
      kind: 'm:1',
      entity: () => Destinations,
      fieldName: 'destination',
      index: 'fk_shippable_products_destinations1_idx',
    },
  },
});
",
]
`;

exports[`4898 nullable_fk_example scalarPropertiesForRelations=always entitySchema=false: 4898 nullable_fk_example scalarPropertiesForRelations=always entitySchema=false 1`] = `
[
  "import { Entity, ManyToOne, OptionalProps, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { RecepientEmails } from './RecepientEmails';
import { SenderEmails } from './SenderEmails';

@Entity()
export class EmailSendingLogs {

  [PrimaryKeyProp]?: 'logId';

  [OptionalProps]?: 'createdAt';

  @PrimaryKey()
  logId!: number;

  @Property({ persist: false })
  senderId!: number;

  @Property({ persist: false })
  recepientId!: number;

  @Property({ persist: false })
  senderEmailId!: number;

  @Property({ persist: false })
  recepientEmailId!: number;

  @Property({ nullable: true, persist: false })
  replyEmailId?: number;

  @Property({ length: 0, defaultRaw: \`CURRENT_TIMESTAMP\` })
  createdAt!: Date;

  @ManyToOne({ entity: () => RecepientEmails, fieldNames: ['recepient_id', 'recepient_email_id'], index: 'fk_email_sending_logs_recepient_emails1_idx' })
  recepient!: RecepientEmails;

  @ManyToOne({ entity: () => SenderEmails, fieldNames: ['sender_id', 'sender_email_id'], index: 'fk_email_sending_logs_sender_emails1_idx' })
  sender!: SenderEmails;

  @ManyToOne({ entity: () => SenderEmails, fieldNames: ['sender_id', 'reply_email_id'], nullable: true, index: 'fk_email_sending_logs_sender_emails2_idx' })
  reply?: SenderEmails;

}
",
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';
import { RecepientEmails } from './RecepientEmails';
import { Recepients } from './Recepients';
import { SenderEmails } from './SenderEmails';
import { Senders } from './Senders';

@Entity()
export class Emails {

  [PrimaryKeyProp]?: 'emailId';

  @PrimaryKey()
  emailId!: number;

  @Unique({ name: 'address_UNIQUE' })
  @Property({ length: 255 })
  address!: string;

  @ManyToMany({ entity: () => Recepients, pivotTable: 'recepient_emails', pivotEntity: () => RecepientEmails, joinColumn: 'email_id', inverseJoinColumn: 'recepient_id' })
  recepientEmails = new Collection<Recepients>(this);

  @ManyToMany({ entity: () => Senders, pivotTable: 'sender_emails', pivotEntity: () => SenderEmails, joinColumn: 'email_id', inverseJoinColumn: 'sender_id' })
  senderEmails = new Collection<Senders>(this);

}
",
  "import { Entity, Index, ManyToOne, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';
import { Emails } from './Emails';
import { Recepients } from './Recepients';

@Entity()
export class RecepientEmails {

  [PrimaryKeyProp]?: ['recepientId', 'emailId', 'email', 'recepient'];

  @PrimaryKey({ persist: false })
  recepientId!: number;

  @Index({ name: 'fk_recepient_emails_emails1_idx' })
  @PrimaryKey({ persist: false })
  emailId!: number;

  @ManyToOne({ entity: () => Emails, fieldName: 'email_id', primary: true, index: 'fk_recepient_emails_emails1_idx' })
  email!: Emails;

  @ManyToOne({ entity: () => Recepients, fieldName: 'recepient_id', primary: true })
  recepient!: Recepients;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';

@Entity()
export class Recepients {

  [PrimaryKeyProp]?: 'recepientId';

  @PrimaryKey()
  recepientId!: number;

  @Property({ length: 255 })
  name!: string;

}
",
  "import { Entity, Index, ManyToOne, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';
import { Emails } from './Emails';
import { Senders } from './Senders';

@Entity()
export class SenderEmails {

  [PrimaryKeyProp]?: ['senderId', 'emailId', 'email', 'sender'];

  @PrimaryKey({ persist: false })
  senderId!: number;

  @Index({ name: 'fk_sender_emails_emails1_idx' })
  @PrimaryKey({ persist: false })
  emailId!: number;

  @ManyToOne({ entity: () => Emails, fieldName: 'email_id', primary: true, index: 'fk_sender_emails_emails1_idx' })
  email!: Emails;

  @ManyToOne({ entity: () => Senders, fieldName: 'sender_id', primary: true })
  sender!: Senders;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';

@Entity()
export class Senders {

  [PrimaryKeyProp]?: 'senderId';

  @PrimaryKey()
  senderId!: number;

  @Property({ length: 255 })
  name!: string;

}
",
]
`;

exports[`4898 nullable_fk_example scalarPropertiesForRelations=always entitySchema=true: 4898 nullable_fk_example scalarPropertiesForRelations=always entitySchema=true 1`] = `
[
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class EmailSendingLogs {
  [PrimaryKeyProp]?: 'logId';
  [OptionalProps]?: 'createdAt';
  logId!: number;
  senderId!: number;
  recepientId!: number;
  senderEmailId!: number;
  recepientEmailId!: number;
  replyEmailId?: number;
  createdAt!: Date;
  recepient!: RecepientEmails;
  sender!: SenderEmails;
  reply?: SenderEmails;
}

export const EmailSendingLogsSchema = new EntitySchema({
  class: EmailSendingLogs,
  properties: {
    logId: { primary: true, type: 'number' },
    senderId: { type: 'number', persist: false },
    recepientId: { type: 'number', persist: false },
    senderEmailId: { type: 'number', persist: false },
    recepientEmailId: { type: 'number', persist: false },
    replyEmailId: { type: 'number', nullable: true, persist: false },
    createdAt: { type: 'Date', length: 0, defaultRaw: \`CURRENT_TIMESTAMP\` },
    recepient: {
      kind: 'm:1',
      entity: () => RecepientEmails,
      fieldNames: [
        'recepient_id',
        'recepient_email_id'
      ],
      index: 'fk_email_sending_logs_recepient_emails1_idx',
    },
    sender: {
      kind: 'm:1',
      entity: () => SenderEmails,
      fieldNames: [
        'sender_id',
        'sender_email_id'
      ],
      index: 'fk_email_sending_logs_sender_emails1_idx',
    },
    reply: {
      kind: 'm:1',
      entity: () => SenderEmails,
      fieldNames: [
        'sender_id',
        'reply_email_id'
      ],
      nullable: true,
      index: 'fk_email_sending_logs_sender_emails2_idx',
    },
  },
});
",
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { Recepients } from './Recepients';
import { Senders } from './Senders';

export class Emails {
  [PrimaryKeyProp]?: 'emailId';
  emailId!: number;
  address!: string;
  recepientEmails = new Collection<Recepients>(this);
  senderEmails = new Collection<Senders>(this);
}

export const EmailsSchema = new EntitySchema({
  class: Emails,
  properties: {
    emailId: { primary: true, type: 'number' },
    address: { type: 'string', length: 255, unique: 'address_UNIQUE' },
    recepientEmails: {
      kind: 'm:n',
      entity: () => Recepients,
      pivotTable: 'recepient_emails',
      pivotEntity: () => RecepientEmails,
      joinColumn: 'email_id',
      inverseJoinColumn: 'recepient_id',
    },
    senderEmails: {
      kind: 'm:n',
      entity: () => Senders,
      pivotTable: 'sender_emails',
      pivotEntity: () => SenderEmails,
      joinColumn: 'email_id',
      inverseJoinColumn: 'sender_id',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class RecepientEmails {
  [PrimaryKeyProp]?: ['recepientId', 'emailId', 'email', 'recepient'];
  recepientId!: number;
  emailId!: number;
  email!: Emails;
  recepient!: Recepients;
}

export const RecepientEmailsSchema = new EntitySchema({
  class: RecepientEmails,
  properties: {
    recepientId: { primary: true, type: 'number', persist: false },
    emailId: {
      primary: true,
      type: 'number',
      persist: false,
      index: 'fk_recepient_emails_emails1_idx',
    },
    email: {
      primary: true,
      kind: 'm:1',
      entity: () => Emails,
      fieldName: 'email_id',
      index: 'fk_recepient_emails_emails1_idx',
    },
    recepient: {
      primary: true,
      kind: 'm:1',
      entity: () => Recepients,
      fieldName: 'recepient_id',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Recepients {
  [PrimaryKeyProp]?: 'recepientId';
  recepientId!: number;
  name!: string;
}

export const RecepientsSchema = new EntitySchema({
  class: Recepients,
  properties: {
    recepientId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255 },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class SenderEmails {
  [PrimaryKeyProp]?: ['senderId', 'emailId', 'email', 'sender'];
  senderId!: number;
  emailId!: number;
  email!: Emails;
  sender!: Senders;
}

export const SenderEmailsSchema = new EntitySchema({
  class: SenderEmails,
  properties: {
    senderId: { primary: true, type: 'number', persist: false },
    emailId: {
      primary: true,
      type: 'number',
      persist: false,
      index: 'fk_sender_emails_emails1_idx',
    },
    email: {
      primary: true,
      kind: 'm:1',
      entity: () => Emails,
      fieldName: 'email_id',
      index: 'fk_sender_emails_emails1_idx',
    },
    sender: { primary: true, kind: 'm:1', entity: () => Senders, fieldName: 'sender_id' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Senders {
  [PrimaryKeyProp]?: 'senderId';
  senderId!: number;
  name!: string;
}

export const SendersSchema = new EntitySchema({
  class: Senders,
  properties: {
    senderId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255 },
  },
});
",
]
`;

exports[`4898 nullable_fk_example scalarPropertiesForRelations=never entitySchema=false: 4898 nullable_fk_example scalarPropertiesForRelations=never entitySchema=false 1`] = `
[
  "import { Entity, ManyToOne, OptionalProps, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { RecepientEmails } from './RecepientEmails';
import { SenderEmails } from './SenderEmails';

@Entity()
export class EmailSendingLogs {

  [PrimaryKeyProp]?: 'logId';

  [OptionalProps]?: 'createdAt';

  @PrimaryKey()
  logId!: number;

  @ManyToOne({ entity: () => RecepientEmails, fieldNames: ['recepient_id', 'recepient_email_id'], index: 'fk_email_sending_logs_recepient_emails1_idx' })
  recepient!: RecepientEmails;

  @ManyToOne({ entity: () => SenderEmails, fieldNames: ['sender_id', 'sender_email_id'], index: 'fk_email_sending_logs_sender_emails1_idx' })
  sender!: SenderEmails;

  @ManyToOne({ entity: () => SenderEmails, fieldNames: ['sender_id', 'reply_email_id'], nullable: true, index: 'fk_email_sending_logs_sender_emails2_idx' })
  reply?: SenderEmails;

  @Property({ length: 0, defaultRaw: \`CURRENT_TIMESTAMP\` })
  createdAt!: Date;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Emails {

  [PrimaryKeyProp]?: 'emailId';

  @PrimaryKey()
  emailId!: number;

  @Unique({ name: 'address_UNIQUE' })
  @Property({ length: 255 })
  address!: string;

}
",
  "import { Entity, ManyToOne, PrimaryKeyProp } from '@mikro-orm/core';
import { Emails } from './Emails';
import { Recepients } from './Recepients';

@Entity()
export class RecepientEmails {

  [PrimaryKeyProp]?: ['recepient', 'email'];

  @ManyToOne({ entity: () => Recepients, fieldName: 'recepient_id', primary: true })
  recepient!: Recepients;

  @ManyToOne({ entity: () => Emails, fieldName: 'email_id', primary: true, index: 'fk_recepient_emails_emails1_idx' })
  email!: Emails;

}
",
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Emails } from './Emails';
import { RecepientEmails } from './RecepientEmails';

@Entity()
export class Recepients {

  [PrimaryKeyProp]?: 'recepientId';

  @PrimaryKey()
  recepientId!: number;

  @Property({ length: 255 })
  name!: string;

  @ManyToMany({ entity: () => Emails, pivotTable: 'recepient_emails', pivotEntity: () => RecepientEmails, joinColumn: 'recepient_id', inverseJoinColumn: 'email_id' })
  recepientEmails = new Collection<Emails>(this);

}
",
  "import { Entity, ManyToOne, PrimaryKeyProp } from '@mikro-orm/core';
import { Emails } from './Emails';
import { Senders } from './Senders';

@Entity()
export class SenderEmails {

  [PrimaryKeyProp]?: ['sender', 'email'];

  @ManyToOne({ entity: () => Senders, fieldName: 'sender_id', primary: true })
  sender!: Senders;

  @ManyToOne({ entity: () => Emails, fieldName: 'email_id', primary: true, index: 'fk_sender_emails_emails1_idx' })
  email!: Emails;

}
",
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Emails } from './Emails';
import { SenderEmails } from './SenderEmails';

@Entity()
export class Senders {

  [PrimaryKeyProp]?: 'senderId';

  @PrimaryKey()
  senderId!: number;

  @Property({ length: 255 })
  name!: string;

  @ManyToMany({ entity: () => Emails, pivotTable: 'sender_emails', pivotEntity: () => SenderEmails, joinColumn: 'sender_id', inverseJoinColumn: 'email_id' })
  senderEmails = new Collection<Emails>(this);

}
",
]
`;

exports[`4898 nullable_fk_example scalarPropertiesForRelations=never entitySchema=true: 4898 nullable_fk_example scalarPropertiesForRelations=never entitySchema=true 1`] = `
[
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class EmailSendingLogs {
  [PrimaryKeyProp]?: 'logId';
  [OptionalProps]?: 'createdAt';
  logId!: number;
  recepient!: RecepientEmails;
  sender!: SenderEmails;
  reply?: SenderEmails;
  createdAt!: Date;
}

export const EmailSendingLogsSchema = new EntitySchema({
  class: EmailSendingLogs,
  properties: {
    logId: { primary: true, type: 'number' },
    recepient: {
      kind: 'm:1',
      entity: () => RecepientEmails,
      fieldNames: [
        'recepient_id',
        'recepient_email_id'
      ],
      index: 'fk_email_sending_logs_recepient_emails1_idx',
    },
    sender: {
      kind: 'm:1',
      entity: () => SenderEmails,
      fieldNames: [
        'sender_id',
        'sender_email_id'
      ],
      index: 'fk_email_sending_logs_sender_emails1_idx',
    },
    reply: {
      kind: 'm:1',
      entity: () => SenderEmails,
      fieldNames: [
        'sender_id',
        'reply_email_id'
      ],
      nullable: true,
      index: 'fk_email_sending_logs_sender_emails2_idx',
    },
    createdAt: { type: 'Date', length: 0, defaultRaw: \`CURRENT_TIMESTAMP\` },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Emails {
  [PrimaryKeyProp]?: 'emailId';
  emailId!: number;
  address!: string;
}

export const EmailsSchema = new EntitySchema({
  class: Emails,
  properties: {
    emailId: { primary: true, type: 'number' },
    address: { type: 'string', length: 255, unique: 'address_UNIQUE' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class RecepientEmails {
  [PrimaryKeyProp]?: ['recepient', 'email'];
  recepient!: Recepients;
  email!: Emails;
}

export const RecepientEmailsSchema = new EntitySchema({
  class: RecepientEmails,
  properties: {
    recepient: {
      primary: true,
      kind: 'm:1',
      entity: () => Recepients,
      fieldName: 'recepient_id',
    },
    email: {
      primary: true,
      kind: 'm:1',
      entity: () => Emails,
      fieldName: 'email_id',
      index: 'fk_recepient_emails_emails1_idx',
    },
  },
});
",
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { Emails } from './Emails';

export class Recepients {
  [PrimaryKeyProp]?: 'recepientId';
  recepientId!: number;
  name!: string;
  recepientEmails = new Collection<Emails>(this);
}

export const RecepientsSchema = new EntitySchema({
  class: Recepients,
  properties: {
    recepientId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255 },
    recepientEmails: {
      kind: 'm:n',
      entity: () => Emails,
      pivotTable: 'recepient_emails',
      pivotEntity: () => RecepientEmails,
      joinColumn: 'recepient_id',
      inverseJoinColumn: 'email_id',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class SenderEmails {
  [PrimaryKeyProp]?: ['sender', 'email'];
  sender!: Senders;
  email!: Emails;
}

export const SenderEmailsSchema = new EntitySchema({
  class: SenderEmails,
  properties: {
    sender: { primary: true, kind: 'm:1', entity: () => Senders, fieldName: 'sender_id' },
    email: {
      primary: true,
      kind: 'm:1',
      entity: () => Emails,
      fieldName: 'email_id',
      index: 'fk_sender_emails_emails1_idx',
    },
  },
});
",
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { Emails } from './Emails';

export class Senders {
  [PrimaryKeyProp]?: 'senderId';
  senderId!: number;
  name!: string;
  senderEmails = new Collection<Emails>(this);
}

export const SendersSchema = new EntitySchema({
  class: Senders,
  properties: {
    senderId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255 },
    senderEmails: {
      kind: 'm:n',
      entity: () => Emails,
      pivotTable: 'sender_emails',
      pivotEntity: () => SenderEmails,
      joinColumn: 'sender_id',
      inverseJoinColumn: 'email_id',
    },
  },
});
",
]
`;

exports[`4898 nullable_fk_example scalarPropertiesForRelations=smart entitySchema=false: 4898 nullable_fk_example scalarPropertiesForRelations=smart entitySchema=false 1`] = `
[
  "import { Entity, ManyToOne, OptionalProps, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { RecepientEmails } from './RecepientEmails';
import { SenderEmails } from './SenderEmails';

@Entity()
export class EmailSendingLogs {

  [PrimaryKeyProp]?: 'logId';

  [OptionalProps]?: 'createdAt';

  @PrimaryKey()
  logId!: number;

  @ManyToOne({ entity: () => RecepientEmails, fieldNames: ['recepient_id', 'recepient_email_id'], index: 'fk_email_sending_logs_recepient_emails1_idx' })
  recepient!: RecepientEmails;

  @ManyToOne({ entity: () => SenderEmails, fieldNames: ['sender_id', 'sender_email_id'], index: 'fk_email_sending_logs_sender_emails1_idx' })
  sender!: SenderEmails;

  @ManyToOne({ entity: () => SenderEmails, fieldNames: ['sender_id', 'reply_email_id'], nullable: true, index: 'fk_email_sending_logs_sender_emails2_idx' })
  reply?: SenderEmails;

  @Property({ length: 0, defaultRaw: \`CURRENT_TIMESTAMP\` })
  createdAt!: Date;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Emails {

  [PrimaryKeyProp]?: 'emailId';

  @PrimaryKey()
  emailId!: number;

  @Unique({ name: 'address_UNIQUE' })
  @Property({ length: 255 })
  address!: string;

}
",
  "import { Entity, ManyToOne, PrimaryKeyProp } from '@mikro-orm/core';
import { Emails } from './Emails';
import { Recepients } from './Recepients';

@Entity()
export class RecepientEmails {

  [PrimaryKeyProp]?: ['recepient', 'email'];

  @ManyToOne({ entity: () => Recepients, fieldName: 'recepient_id', primary: true })
  recepient!: Recepients;

  @ManyToOne({ entity: () => Emails, fieldName: 'email_id', primary: true, index: 'fk_recepient_emails_emails1_idx' })
  email!: Emails;

}
",
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Emails } from './Emails';
import { RecepientEmails } from './RecepientEmails';

@Entity()
export class Recepients {

  [PrimaryKeyProp]?: 'recepientId';

  @PrimaryKey()
  recepientId!: number;

  @Property({ length: 255 })
  name!: string;

  @ManyToMany({ entity: () => Emails, pivotTable: 'recepient_emails', pivotEntity: () => RecepientEmails, joinColumn: 'recepient_id', inverseJoinColumn: 'email_id' })
  recepientEmails = new Collection<Emails>(this);

}
",
  "import { Entity, ManyToOne, PrimaryKeyProp } from '@mikro-orm/core';
import { Emails } from './Emails';
import { Senders } from './Senders';

@Entity()
export class SenderEmails {

  [PrimaryKeyProp]?: ['sender', 'email'];

  @ManyToOne({ entity: () => Senders, fieldName: 'sender_id', primary: true })
  sender!: Senders;

  @ManyToOne({ entity: () => Emails, fieldName: 'email_id', primary: true, index: 'fk_sender_emails_emails1_idx' })
  email!: Emails;

}
",
  "import { Collection, Entity, ManyToMany, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Emails } from './Emails';
import { SenderEmails } from './SenderEmails';

@Entity()
export class Senders {

  [PrimaryKeyProp]?: 'senderId';

  @PrimaryKey()
  senderId!: number;

  @Property({ length: 255 })
  name!: string;

  @ManyToMany({ entity: () => Emails, pivotTable: 'sender_emails', pivotEntity: () => SenderEmails, joinColumn: 'sender_id', inverseJoinColumn: 'email_id' })
  senderEmails = new Collection<Emails>(this);

}
",
]
`;

exports[`4898 nullable_fk_example scalarPropertiesForRelations=smart entitySchema=true: 4898 nullable_fk_example scalarPropertiesForRelations=smart entitySchema=true 1`] = `
[
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class EmailSendingLogs {
  [PrimaryKeyProp]?: 'logId';
  [OptionalProps]?: 'createdAt';
  logId!: number;
  recepient!: RecepientEmails;
  sender!: SenderEmails;
  reply?: SenderEmails;
  createdAt!: Date;
}

export const EmailSendingLogsSchema = new EntitySchema({
  class: EmailSendingLogs,
  properties: {
    logId: { primary: true, type: 'number' },
    recepient: {
      kind: 'm:1',
      entity: () => RecepientEmails,
      fieldNames: [
        'recepient_id',
        'recepient_email_id'
      ],
      index: 'fk_email_sending_logs_recepient_emails1_idx',
    },
    sender: {
      kind: 'm:1',
      entity: () => SenderEmails,
      fieldNames: [
        'sender_id',
        'sender_email_id'
      ],
      index: 'fk_email_sending_logs_sender_emails1_idx',
    },
    reply: {
      kind: 'm:1',
      entity: () => SenderEmails,
      fieldNames: [
        'sender_id',
        'reply_email_id'
      ],
      nullable: true,
      index: 'fk_email_sending_logs_sender_emails2_idx',
    },
    createdAt: { type: 'Date', length: 0, defaultRaw: \`CURRENT_TIMESTAMP\` },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Emails {
  [PrimaryKeyProp]?: 'emailId';
  emailId!: number;
  address!: string;
}

export const EmailsSchema = new EntitySchema({
  class: Emails,
  properties: {
    emailId: { primary: true, type: 'number' },
    address: { type: 'string', length: 255, unique: 'address_UNIQUE' },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class RecepientEmails {
  [PrimaryKeyProp]?: ['recepient', 'email'];
  recepient!: Recepients;
  email!: Emails;
}

export const RecepientEmailsSchema = new EntitySchema({
  class: RecepientEmails,
  properties: {
    recepient: {
      primary: true,
      kind: 'm:1',
      entity: () => Recepients,
      fieldName: 'recepient_id',
    },
    email: {
      primary: true,
      kind: 'm:1',
      entity: () => Emails,
      fieldName: 'email_id',
      index: 'fk_recepient_emails_emails1_idx',
    },
  },
});
",
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { Emails } from './Emails';

export class Recepients {
  [PrimaryKeyProp]?: 'recepientId';
  recepientId!: number;
  name!: string;
  recepientEmails = new Collection<Emails>(this);
}

export const RecepientsSchema = new EntitySchema({
  class: Recepients,
  properties: {
    recepientId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255 },
    recepientEmails: {
      kind: 'm:n',
      entity: () => Emails,
      pivotTable: 'recepient_emails',
      pivotEntity: () => RecepientEmails,
      joinColumn: 'recepient_id',
      inverseJoinColumn: 'email_id',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class SenderEmails {
  [PrimaryKeyProp]?: ['sender', 'email'];
  sender!: Senders;
  email!: Emails;
}

export const SenderEmailsSchema = new EntitySchema({
  class: SenderEmails,
  properties: {
    sender: { primary: true, kind: 'm:1', entity: () => Senders, fieldName: 'sender_id' },
    email: {
      primary: true,
      kind: 'm:1',
      entity: () => Emails,
      fieldName: 'email_id',
      index: 'fk_sender_emails_emails1_idx',
    },
  },
});
",
  "import { Collection, EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';
import { Emails } from './Emails';

export class Senders {
  [PrimaryKeyProp]?: 'senderId';
  senderId!: number;
  name!: string;
  senderEmails = new Collection<Emails>(this);
}

export const SendersSchema = new EntitySchema({
  class: Senders,
  properties: {
    senderId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255 },
    senderEmails: {
      kind: 'm:n',
      entity: () => Emails,
      pivotTable: 'sender_emails',
      pivotEntity: () => SenderEmails,
      joinColumn: 'sender_id',
      inverseJoinColumn: 'email_id',
    },
  },
});
",
]
`;

exports[`4898 overlap_fk_example scalarPropertiesForRelations=always entitySchema=false: 4898 overlap_fk_example scalarPropertiesForRelations=always entitySchema=false 1`] = `
[
  "import { Entity, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';

@Entity()
export class Countries {

  [PrimaryKeyProp]?: 'code';

  @PrimaryKey({ columnType: 'char(2)' })
  code!: unknown;

}
",
  "import { Entity, Index, ManyToOne, OptionalProps, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Countries } from './Countries';
import { Products } from './Products';

@Entity()
export class ProductCountryMap {

  [PrimaryKeyProp]?: ['country', 'productId', 'countries', 'product'];

  [OptionalProps]?: 'isCurrentlyAllowed';

  @PrimaryKey({ columnType: 'char(2)', persist: false })
  country!: unknown;

  @Index({ name: 'fk_product_country_map_products1' })
  @PrimaryKey({ persist: false })
  productId!: number;

  @Property({ default: false })
  isCurrentlyAllowed: boolean = false;

  @ManyToOne({ entity: () => Countries, fieldName: 'country', primary: true })
  countries!: Countries;

  @ManyToOne({ entity: () => Products, fieldName: 'product_id', primary: true, index: 'fk_product_country_map_products1' })
  product!: Products;

}
",
  "import { Entity, Index, ManyToOne, OptionalProps, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Products } from './Products';
import { Sellers } from './Sellers';

@Entity()
export class ProductSellers {

  [PrimaryKeyProp]?: ['sellerId', 'productId', 'product', 'seller'];

  [OptionalProps]?: 'isCurrentlyAllowed';

  @PrimaryKey({ persist: false })
  sellerId!: number;

  @Index({ name: 'fk_product_sellers_products1' })
  @PrimaryKey({ persist: false })
  productId!: number;

  @Property({ default: false })
  isCurrentlyAllowed: boolean = false;

  @ManyToOne({ entity: () => Products, fieldName: 'product_id', updateRule: 'cascade', deleteRule: 'cascade', primary: true, index: 'fk_product_sellers_products1' })
  product!: Products;

  @ManyToOne({ entity: () => Sellers, fieldName: 'seller_id', updateRule: 'cascade', deleteRule: 'cascade', primary: true })
  seller!: Sellers;

}
",
  "import { Entity, OptionalProps, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Products {

  [PrimaryKeyProp]?: 'productId';

  [OptionalProps]?: 'currentQuantity';

  @PrimaryKey()
  productId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

  @Property({ columnType: 'numeric(10,2)' })
  currentPrice!: string;

  @Property({ default: 0 })
  currentQuantity: number = 0;

}
",
  "import { Entity, Index, ManyToOne, OptionalProps, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { ProductCountryMap } from './ProductCountryMap';
import { ProductSellers } from './ProductSellers';

@Entity()
export class Sales {

  [PrimaryKeyProp]?: 'saleId';

  [OptionalProps]?: 'quantitySold';

  @PrimaryKey()
  saleId!: number;

  @Property({ columnType: 'char(2)', persist: false })
  country!: unknown;

  @Property({ persist: false })
  sellerId!: number;

  @Index({ name: 'product_id_idx' })
  @Property({ persist: false })
  productId!: number;

  @Property({ columnType: 'numeric(10,2)' })
  singularPrice!: string;

  @Property({ default: 1 })
  quantitySold: number = 1;

  @ManyToOne({ entity: () => ProductCountryMap, fieldNames: ['country', 'product_id'], updateRule: 'cascade', index: 'fk_sales_product_country_map1_idx' })
  productCountryMap!: ProductCountryMap;

  @ManyToOne({ entity: () => ProductSellers, fieldNames: ['seller_id', 'product_id'], updateRule: 'cascade', index: 'fk_sales_product_sellers1_idx' })
  seller!: ProductSellers;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Sellers {

  [PrimaryKeyProp]?: 'sellerId';

  @PrimaryKey()
  sellerId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

}
",
]
`;

exports[`4898 overlap_fk_example scalarPropertiesForRelations=always entitySchema=true: 4898 overlap_fk_example scalarPropertiesForRelations=always entitySchema=true 1`] = `
[
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Countries {
  [PrimaryKeyProp]?: 'code';
  code!: unknown;
}

export const CountriesSchema = new EntitySchema({
  class: Countries,
  properties: {
    code: { primary: true, type: 'unknown', columnType: 'char(2)' },
  },
});
",
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class ProductCountryMap {
  [PrimaryKeyProp]?: ['country', 'productId', 'countries', 'product'];
  [OptionalProps]?: 'isCurrentlyAllowed';
  country!: unknown;
  productId!: number;
  isCurrentlyAllowed: boolean = false;
  countries!: Countries;
  product!: Products;
}

export const ProductCountryMapSchema = new EntitySchema({
  class: ProductCountryMap,
  properties: {
    country: { primary: true, type: 'unknown', columnType: 'char(2)', persist: false },
    productId: {
      primary: true,
      type: 'number',
      persist: false,
      index: 'fk_product_country_map_products1',
    },
    isCurrentlyAllowed: { type: 'boolean', default: false },
    countries: { primary: true, kind: 'm:1', entity: () => Countries, fieldName: 'country' },
    product: {
      primary: true,
      kind: 'm:1',
      entity: () => Products,
      fieldName: 'product_id',
      index: 'fk_product_country_map_products1',
    },
  },
});
",
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class ProductSellers {
  [PrimaryKeyProp]?: ['sellerId', 'productId', 'product', 'seller'];
  [OptionalProps]?: 'isCurrentlyAllowed';
  sellerId!: number;
  productId!: number;
  isCurrentlyAllowed: boolean = false;
  product!: Products;
  seller!: Sellers;
}

export const ProductSellersSchema = new EntitySchema({
  class: ProductSellers,
  properties: {
    sellerId: { primary: true, type: 'number', persist: false },
    productId: {
      primary: true,
      type: 'number',
      persist: false,
      index: 'fk_product_sellers_products1',
    },
    isCurrentlyAllowed: { type: 'boolean', default: false },
    product: {
      primary: true,
      kind: 'm:1',
      entity: () => Products,
      fieldName: 'product_id',
      updateRule: 'cascade',
      deleteRule: 'cascade',
      index: 'fk_product_sellers_products1',
    },
    seller: {
      primary: true,
      kind: 'm:1',
      entity: () => Sellers,
      fieldName: 'seller_id',
      updateRule: 'cascade',
      deleteRule: 'cascade',
    },
  },
});
",
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class Products {
  [PrimaryKeyProp]?: 'productId';
  [OptionalProps]?: 'currentQuantity';
  productId!: number;
  name!: string;
  currentPrice!: string;
  currentQuantity: number = 0;
}

export const ProductsSchema = new EntitySchema({
  class: Products,
  properties: {
    productId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
    currentPrice: { type: 'string', columnType: 'numeric(10,2)' },
    currentQuantity: { type: 'number', default: 0 },
  },
});
",
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class Sales {
  [PrimaryKeyProp]?: 'saleId';
  [OptionalProps]?: 'quantitySold';
  saleId!: number;
  country!: unknown;
  sellerId!: number;
  productId!: number;
  singularPrice!: string;
  quantitySold: number = 1;
  productCountryMap!: ProductCountryMap;
  seller!: ProductSellers;
}

export const SalesSchema = new EntitySchema({
  class: Sales,
  properties: {
    saleId: { primary: true, type: 'number' },
    country: { type: 'unknown', columnType: 'char(2)', persist: false },
    sellerId: { type: 'number', persist: false },
    productId: { type: 'number', persist: false, index: 'product_id_idx' },
    singularPrice: { type: 'string', columnType: 'numeric(10,2)' },
    quantitySold: { type: 'number', default: 1 },
    productCountryMap: {
      kind: 'm:1',
      entity: () => ProductCountryMap,
      fieldNames: [
        'country',
        'product_id'
      ],
      updateRule: 'cascade',
      index: 'fk_sales_product_country_map1_idx',
    },
    seller: {
      kind: 'm:1',
      entity: () => ProductSellers,
      fieldNames: [
        'seller_id',
        'product_id'
      ],
      updateRule: 'cascade',
      index: 'fk_sales_product_sellers1_idx',
    },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Sellers {
  [PrimaryKeyProp]?: 'sellerId';
  sellerId!: number;
  name!: string;
}

export const SellersSchema = new EntitySchema({
  class: Sellers,
  properties: {
    sellerId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
  },
});
",
]
`;

exports[`4898 overlap_fk_example scalarPropertiesForRelations=never entitySchema=false: 4898 overlap_fk_example scalarPropertiesForRelations=never entitySchema=false 1`] = `
[
  "import { Entity, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';

@Entity()
export class Countries {

  [PrimaryKeyProp]?: 'code';

  @PrimaryKey({ columnType: 'char(2)' })
  code!: unknown;

}
",
  "import { Entity, ManyToOne, OptionalProps, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Countries } from './Countries';
import { Products } from './Products';

@Entity()
export class ProductCountryMap {

  [PrimaryKeyProp]?: ['country', 'product'];

  [OptionalProps]?: 'isCurrentlyAllowed';

  @ManyToOne({ entity: () => Countries, fieldName: 'country', primary: true })
  country!: Countries;

  @ManyToOne({ entity: () => Products, fieldName: 'product_id', primary: true, index: 'fk_product_country_map_products1' })
  product!: Products;

  @Property({ default: false })
  isCurrentlyAllowed: boolean = false;

}
",
  "import { Entity, ManyToOne, OptionalProps, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Products } from './Products';
import { Sellers } from './Sellers';

@Entity()
export class ProductSellers {

  [PrimaryKeyProp]?: ['seller', 'product'];

  [OptionalProps]?: 'isCurrentlyAllowed';

  @ManyToOne({ entity: () => Sellers, fieldName: 'seller_id', updateRule: 'cascade', deleteRule: 'cascade', primary: true })
  seller!: Sellers;

  @ManyToOne({ entity: () => Products, fieldName: 'product_id', updateRule: 'cascade', deleteRule: 'cascade', primary: true, index: 'fk_product_sellers_products1' })
  product!: Products;

  @Property({ default: false })
  isCurrentlyAllowed: boolean = false;

}
",
  "import { Entity, OptionalProps, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Products {

  [PrimaryKeyProp]?: 'productId';

  [OptionalProps]?: 'currentQuantity';

  @PrimaryKey()
  productId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

  @Property({ columnType: 'numeric(10,2)' })
  currentPrice!: string;

  @Property({ default: 0 })
  currentQuantity: number = 0;

}
",
  "import { Entity, Index, ManyToOne, OptionalProps, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { ProductCountryMap } from './ProductCountryMap';
import { ProductSellers } from './ProductSellers';

@Entity()
@Index({ name: 'product_id_idx', expression: 'create index \`product_id_idx\` on \`sales\` (\`product_id\`)')
export class Sales {

  [PrimaryKeyProp]?: 'saleId';

  [OptionalProps]?: 'quantitySold';

  @PrimaryKey()
  saleId!: number;

  @ManyToOne({ entity: () => ProductCountryMap, fieldNames: ['country', 'product_id'], updateRule: 'cascade', index: 'fk_sales_product_country_map1_idx' })
  country!: ProductCountryMap;

  @ManyToOne({ entity: () => ProductSellers, fieldNames: ['seller_id', 'product_id'], updateRule: 'cascade', index: 'fk_sales_product_sellers1_idx' })
  seller!: ProductSellers;

  @Property({ columnType: 'numeric(10,2)' })
  singularPrice!: string;

  @Property({ default: 1 })
  quantitySold: number = 1;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Sellers {

  [PrimaryKeyProp]?: 'sellerId';

  @PrimaryKey()
  sellerId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

}
",
]
`;

exports[`4898 overlap_fk_example scalarPropertiesForRelations=never entitySchema=true: 4898 overlap_fk_example scalarPropertiesForRelations=never entitySchema=true 1`] = `
[
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Countries {
  [PrimaryKeyProp]?: 'code';
  code!: unknown;
}

export const CountriesSchema = new EntitySchema({
  class: Countries,
  properties: {
    code: { primary: true, type: 'unknown', columnType: 'char(2)' },
  },
});
",
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class ProductCountryMap {
  [PrimaryKeyProp]?: ['country', 'product'];
  [OptionalProps]?: 'isCurrentlyAllowed';
  country!: Countries;
  product!: Products;
  isCurrentlyAllowed: boolean = false;
}

export const ProductCountryMapSchema = new EntitySchema({
  class: ProductCountryMap,
  properties: {
    country: { primary: true, kind: 'm:1', entity: () => Countries, fieldName: 'country' },
    product: {
      primary: true,
      kind: 'm:1',
      entity: () => Products,
      fieldName: 'product_id',
      index: 'fk_product_country_map_products1',
    },
    isCurrentlyAllowed: { type: 'boolean', default: false },
  },
});
",
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class ProductSellers {
  [PrimaryKeyProp]?: ['seller', 'product'];
  [OptionalProps]?: 'isCurrentlyAllowed';
  seller!: Sellers;
  product!: Products;
  isCurrentlyAllowed: boolean = false;
}

export const ProductSellersSchema = new EntitySchema({
  class: ProductSellers,
  properties: {
    seller: {
      primary: true,
      kind: 'm:1',
      entity: () => Sellers,
      fieldName: 'seller_id',
      updateRule: 'cascade',
      deleteRule: 'cascade',
    },
    product: {
      primary: true,
      kind: 'm:1',
      entity: () => Products,
      fieldName: 'product_id',
      updateRule: 'cascade',
      deleteRule: 'cascade',
      index: 'fk_product_sellers_products1',
    },
    isCurrentlyAllowed: { type: 'boolean', default: false },
  },
});
",
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class Products {
  [PrimaryKeyProp]?: 'productId';
  [OptionalProps]?: 'currentQuantity';
  productId!: number;
  name!: string;
  currentPrice!: string;
  currentQuantity: number = 0;
}

export const ProductsSchema = new EntitySchema({
  class: Products,
  properties: {
    productId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
    currentPrice: { type: 'string', columnType: 'numeric(10,2)' },
    currentQuantity: { type: 'number', default: 0 },
  },
});
",
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class Sales {
  [PrimaryKeyProp]?: 'saleId';
  [OptionalProps]?: 'quantitySold';
  saleId!: number;
  country!: ProductCountryMap;
  seller!: ProductSellers;
  singularPrice!: string;
  quantitySold: number = 1;
}

export const SalesSchema = new EntitySchema({
  class: Sales,
  indexes: [
    { name: 'product_id_idx', expression: 'create index \`product_id_idx\` on \`sales\` (\`product_id\`)' },
  ],
  uniques: [
  ],
  properties: {
    saleId: { primary: true, type: 'number' },
    country: {
      kind: 'm:1',
      entity: () => ProductCountryMap,
      fieldNames: [
        'country',
        'product_id'
      ],
      updateRule: 'cascade',
      index: 'fk_sales_product_country_map1_idx',
    },
    seller: {
      kind: 'm:1',
      entity: () => ProductSellers,
      fieldNames: [
        'seller_id',
        'product_id'
      ],
      updateRule: 'cascade',
      index: 'fk_sales_product_sellers1_idx',
    },
    singularPrice: { type: 'string', columnType: 'numeric(10,2)' },
    quantitySold: { type: 'number', default: 1 },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Sellers {
  [PrimaryKeyProp]?: 'sellerId';
  sellerId!: number;
  name!: string;
}

export const SellersSchema = new EntitySchema({
  class: Sellers,
  properties: {
    sellerId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
  },
});
",
]
`;

exports[`4898 overlap_fk_example scalarPropertiesForRelations=smart entitySchema=false: 4898 overlap_fk_example scalarPropertiesForRelations=smart entitySchema=false 1`] = `
[
  "import { Entity, PrimaryKey, PrimaryKeyProp } from '@mikro-orm/core';

@Entity()
export class Countries {

  [PrimaryKeyProp]?: 'code';

  @PrimaryKey({ columnType: 'char(2)' })
  code!: unknown;

}
",
  "import { Entity, ManyToOne, OptionalProps, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Countries } from './Countries';
import { Products } from './Products';

@Entity()
export class ProductCountryMap {

  [PrimaryKeyProp]?: ['country', 'product'];

  [OptionalProps]?: 'isCurrentlyAllowed';

  @ManyToOne({ entity: () => Countries, fieldName: 'country', primary: true })
  country!: Countries;

  @ManyToOne({ entity: () => Products, fieldName: 'product_id', primary: true, index: 'fk_product_country_map_products1' })
  product!: Products;

  @Property({ default: false })
  isCurrentlyAllowed: boolean = false;

}
",
  "import { Entity, ManyToOne, OptionalProps, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { Products } from './Products';
import { Sellers } from './Sellers';

@Entity()
export class ProductSellers {

  [PrimaryKeyProp]?: ['seller', 'product'];

  [OptionalProps]?: 'isCurrentlyAllowed';

  @ManyToOne({ entity: () => Sellers, fieldName: 'seller_id', updateRule: 'cascade', deleteRule: 'cascade', primary: true })
  seller!: Sellers;

  @ManyToOne({ entity: () => Products, fieldName: 'product_id', updateRule: 'cascade', deleteRule: 'cascade', primary: true, index: 'fk_product_sellers_products1' })
  product!: Products;

  @Property({ default: false })
  isCurrentlyAllowed: boolean = false;

}
",
  "import { Entity, OptionalProps, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Products {

  [PrimaryKeyProp]?: 'productId';

  [OptionalProps]?: 'currentQuantity';

  @PrimaryKey()
  productId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

  @Property({ columnType: 'numeric(10,2)' })
  currentPrice!: string;

  @Property({ default: 0 })
  currentQuantity: number = 0;

}
",
  "import { Entity, Index, ManyToOne, OptionalProps, PrimaryKey, PrimaryKeyProp, Property } from '@mikro-orm/core';
import { ProductCountryMap } from './ProductCountryMap';
import { ProductSellers } from './ProductSellers';

@Entity()
@Index({ name: 'product_id_idx', expression: 'create index \`product_id_idx\` on \`sales\` (\`product_id\`)')
export class Sales {

  [PrimaryKeyProp]?: 'saleId';

  [OptionalProps]?: 'quantitySold';

  @PrimaryKey()
  saleId!: number;

  @ManyToOne({ entity: () => ProductCountryMap, fieldNames: ['country', 'product_id'], updateRule: 'cascade', index: 'fk_sales_product_country_map1_idx' })
  country!: ProductCountryMap;

  @ManyToOne({ entity: () => ProductSellers, fieldNames: ['seller_id', 'product_id'], updateRule: 'cascade', index: 'fk_sales_product_sellers1_idx' })
  seller!: ProductSellers;

  @Property({ columnType: 'numeric(10,2)' })
  singularPrice!: string;

  @Property({ default: 1 })
  quantitySold: number = 1;

}
",
  "import { Entity, PrimaryKey, PrimaryKeyProp, Property, Unique } from '@mikro-orm/core';

@Entity()
export class Sellers {

  [PrimaryKeyProp]?: 'sellerId';

  @PrimaryKey()
  sellerId!: number;

  @Unique({ name: 'name_UNIQUE' })
  @Property({ length: 255 })
  name!: string;

}
",
]
`;

exports[`4898 overlap_fk_example scalarPropertiesForRelations=smart entitySchema=true: 4898 overlap_fk_example scalarPropertiesForRelations=smart entitySchema=true 1`] = `
[
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Countries {
  [PrimaryKeyProp]?: 'code';
  code!: unknown;
}

export const CountriesSchema = new EntitySchema({
  class: Countries,
  properties: {
    code: { primary: true, type: 'unknown', columnType: 'char(2)' },
  },
});
",
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class ProductCountryMap {
  [PrimaryKeyProp]?: ['country', 'product'];
  [OptionalProps]?: 'isCurrentlyAllowed';
  country!: Countries;
  product!: Products;
  isCurrentlyAllowed: boolean = false;
}

export const ProductCountryMapSchema = new EntitySchema({
  class: ProductCountryMap,
  properties: {
    country: { primary: true, kind: 'm:1', entity: () => Countries, fieldName: 'country' },
    product: {
      primary: true,
      kind: 'm:1',
      entity: () => Products,
      fieldName: 'product_id',
      index: 'fk_product_country_map_products1',
    },
    isCurrentlyAllowed: { type: 'boolean', default: false },
  },
});
",
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class ProductSellers {
  [PrimaryKeyProp]?: ['seller', 'product'];
  [OptionalProps]?: 'isCurrentlyAllowed';
  seller!: Sellers;
  product!: Products;
  isCurrentlyAllowed: boolean = false;
}

export const ProductSellersSchema = new EntitySchema({
  class: ProductSellers,
  properties: {
    seller: {
      primary: true,
      kind: 'm:1',
      entity: () => Sellers,
      fieldName: 'seller_id',
      updateRule: 'cascade',
      deleteRule: 'cascade',
    },
    product: {
      primary: true,
      kind: 'm:1',
      entity: () => Products,
      fieldName: 'product_id',
      updateRule: 'cascade',
      deleteRule: 'cascade',
      index: 'fk_product_sellers_products1',
    },
    isCurrentlyAllowed: { type: 'boolean', default: false },
  },
});
",
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class Products {
  [PrimaryKeyProp]?: 'productId';
  [OptionalProps]?: 'currentQuantity';
  productId!: number;
  name!: string;
  currentPrice!: string;
  currentQuantity: number = 0;
}

export const ProductsSchema = new EntitySchema({
  class: Products,
  properties: {
    productId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
    currentPrice: { type: 'string', columnType: 'numeric(10,2)' },
    currentQuantity: { type: 'number', default: 0 },
  },
});
",
  "import { EntitySchema, OptionalProps, PrimaryKeyProp } from '@mikro-orm/core';

export class Sales {
  [PrimaryKeyProp]?: 'saleId';
  [OptionalProps]?: 'quantitySold';
  saleId!: number;
  country!: ProductCountryMap;
  seller!: ProductSellers;
  singularPrice!: string;
  quantitySold: number = 1;
}

export const SalesSchema = new EntitySchema({
  class: Sales,
  indexes: [
    { name: 'product_id_idx', expression: 'create index \`product_id_idx\` on \`sales\` (\`product_id\`)' },
  ],
  uniques: [
  ],
  properties: {
    saleId: { primary: true, type: 'number' },
    country: {
      kind: 'm:1',
      entity: () => ProductCountryMap,
      fieldNames: [
        'country',
        'product_id'
      ],
      updateRule: 'cascade',
      index: 'fk_sales_product_country_map1_idx',
    },
    seller: {
      kind: 'm:1',
      entity: () => ProductSellers,
      fieldNames: [
        'seller_id',
        'product_id'
      ],
      updateRule: 'cascade',
      index: 'fk_sales_product_sellers1_idx',
    },
    singularPrice: { type: 'string', columnType: 'numeric(10,2)' },
    quantitySold: { type: 'number', default: 1 },
  },
});
",
  "import { EntitySchema, PrimaryKeyProp } from '@mikro-orm/core';

export class Sellers {
  [PrimaryKeyProp]?: 'sellerId';
  sellerId!: number;
  name!: string;
}

export const SellersSchema = new EntitySchema({
  class: Sellers,
  properties: {
    sellerId: { primary: true, type: 'number' },
    name: { type: 'string', length: 255, unique: 'name_UNIQUE' },
  },
});
",
]
`;
